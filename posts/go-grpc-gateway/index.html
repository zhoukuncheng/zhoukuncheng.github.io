<!doctype html><html lang=en dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Developing RESTful APIs with gRPC-Gateway | zhoukuncheng's Personal Blog</title><meta name=keywords content="Golang,Web,gRPC,gRPC-gateway"><meta name=description content="Introduction to gRPC-Gateway
gRPC-Gateway is a plugin for protoc. It works by reading a gRPC service definition and generating a reverse proxy server that translates a RESTful JSON API into gRPC.
This server is generated according to the custom options in your gRPC definition.

Installation and Usage
Dependencies

  
      
          Tool
          Introduction
          Installation
      
  
  
      
          protobuf
          Command line tool for protocol buffer compilation
          http://google.github.io/proto-lens/installing-protoc.html
      
      
          protoc-gen-go
          Generates .go files from proto files
          https://grpc.io/docs/languages/go/quickstart/
      
      
          protoc-gen-go-grpc
          Generates gRPC related .go files from proto files
          https://grpc.io/docs/languages/go/quickstart/
      
      
          protoc-gen-grpc-gateway
          Generates gRPC-gateway related .go files from proto files
          https://github.com/grpc-ecosystem/grpc-gateway#installation
      
      
          protoc-gen-openapiv2
          Generates parameter files required for Swagger documentation from proto files
          https://github.com/grpc-ecosystem/grpc-gateway#installation
      
      
          buf
          Protobuf management tool, optional, simplifies command line operations and protobuf file management
          https://docs.buf.build/installation
      
  

Steps
Write buf configuration
buf.gen.yaml"><meta name=author content="zhoukuncheng"><link rel=canonical href=https://zhoukuncheng.github.io/posts/go-grpc-gateway/><link crossorigin=anonymous href=/assets/css/stylesheet.343cc480b9ffc8f04ccbe5e968ad674880cab773ec19905e93033065c1e7a804.css integrity="sha256-NDzEgLn/yPBMy+XpaK1nSIDKt3PsGZBekwMwZcHnqAQ=" rel="preload stylesheet" as=style><link rel=icon href=https://zhoukuncheng.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://zhoukuncheng.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://zhoukuncheng.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://zhoukuncheng.github.io/apple-touch-icon.png><link rel=mask-icon href=https://zhoukuncheng.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://zhoukuncheng.github.io/zh/posts/go-grpc-gateway/><link rel=alternate hreflang=en href=https://zhoukuncheng.github.io/posts/go-grpc-gateway/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-GH88YSLNJN"></script><script>var doNotTrack=!1,dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-GH88YSLNJN")}</script><meta property="og:url" content="https://zhoukuncheng.github.io/posts/go-grpc-gateway/"><meta property="og:site_name" content="zhoukuncheng's Personal Blog"><meta property="og:title" content="Developing RESTful APIs with gRPC-Gateway"><meta property="og:description" content="Introduction to gRPC-Gateway gRPC-Gateway is a plugin for protoc. It works by reading a gRPC service definition and generating a reverse proxy server that translates a RESTful JSON API into gRPC.
This server is generated according to the custom options in your gRPC definition.
Installation and Usage Dependencies Tool Introduction Installation protobuf Command line tool for protocol buffer compilation http://google.github.io/proto-lens/installing-protoc.html protoc-gen-go Generates .go files from proto files https://grpc.io/docs/languages/go/quickstart/ protoc-gen-go-grpc Generates gRPC related .go files from proto files https://grpc.io/docs/languages/go/quickstart/ protoc-gen-grpc-gateway Generates gRPC-gateway related .go files from proto files https://github.com/grpc-ecosystem/grpc-gateway#installation protoc-gen-openapiv2 Generates parameter files required for Swagger documentation from proto files https://github.com/grpc-ecosystem/grpc-gateway#installation buf Protobuf management tool, optional, simplifies command line operations and protobuf file management https://docs.buf.build/installation Steps Write buf configuration buf.gen.yaml"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-03-13T18:13:14+08:00"><meta property="article:modified_time" content="2022-03-13T18:13:14+08:00"><meta property="article:tag" content="Golang"><meta property="article:tag" content="Web"><meta property="article:tag" content="GRPC"><meta property="article:tag" content="GRPC-Gateway"><meta name=twitter:card content="summary"><meta name=twitter:title content="Developing RESTful APIs with gRPC-Gateway"><meta name=twitter:description content="Introduction to gRPC-Gateway
gRPC-Gateway is a plugin for protoc. It works by reading a gRPC service definition and generating a reverse proxy server that translates a RESTful JSON API into gRPC.
This server is generated according to the custom options in your gRPC definition.

Installation and Usage
Dependencies

  
      
          Tool
          Introduction
          Installation
      
  
  
      
          protobuf
          Command line tool for protocol buffer compilation
          http://google.github.io/proto-lens/installing-protoc.html
      
      
          protoc-gen-go
          Generates .go files from proto files
          https://grpc.io/docs/languages/go/quickstart/
      
      
          protoc-gen-go-grpc
          Generates gRPC related .go files from proto files
          https://grpc.io/docs/languages/go/quickstart/
      
      
          protoc-gen-grpc-gateway
          Generates gRPC-gateway related .go files from proto files
          https://github.com/grpc-ecosystem/grpc-gateway#installation
      
      
          protoc-gen-openapiv2
          Generates parameter files required for Swagger documentation from proto files
          https://github.com/grpc-ecosystem/grpc-gateway#installation
      
      
          buf
          Protobuf management tool, optional, simplifies command line operations and protobuf file management
          https://docs.buf.build/installation
      
  

Steps
Write buf configuration
buf.gen.yaml"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://zhoukuncheng.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Developing RESTful APIs with gRPC-Gateway","item":"https://zhoukuncheng.github.io/posts/go-grpc-gateway/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Developing RESTful APIs with gRPC-Gateway","name":"Developing RESTful APIs with gRPC-Gateway","description":"Introduction to gRPC-Gateway gRPC-Gateway is a plugin for protoc. It works by reading a gRPC service definition and generating a reverse proxy server that translates a RESTful JSON API into gRPC.\nThis server is generated according to the custom options in your gRPC definition.\nInstallation and Usage Dependencies Tool Introduction Installation protobuf Command line tool for protocol buffer compilation http://google.github.io/proto-lens/installing-protoc.html protoc-gen-go Generates .go files from proto files https://grpc.io/docs/languages/go/quickstart/ protoc-gen-go-grpc Generates gRPC related .go files from proto files https://grpc.io/docs/languages/go/quickstart/ protoc-gen-grpc-gateway Generates gRPC-gateway related .go files from proto files https://github.com/grpc-ecosystem/grpc-gateway#installation protoc-gen-openapiv2 Generates parameter files required for Swagger documentation from proto files https://github.com/grpc-ecosystem/grpc-gateway#installation buf Protobuf management tool, optional, simplifies command line operations and protobuf file management https://docs.buf.build/installation Steps Write buf configuration buf.gen.yaml\n","keywords":["Golang","Web","gRPC","gRPC-gateway"],"articleBody":"Introduction to gRPC-Gateway gRPC-Gateway is a plugin for protoc. It works by reading a gRPC service definition and generating a reverse proxy server that translates a RESTful JSON API into gRPC.\nThis server is generated according to the custom options in your gRPC definition.\nInstallation and Usage Dependencies Tool Introduction Installation protobuf Command line tool for protocol buffer compilation http://google.github.io/proto-lens/installing-protoc.html protoc-gen-go Generates .go files from proto files https://grpc.io/docs/languages/go/quickstart/ protoc-gen-go-grpc Generates gRPC related .go files from proto files https://grpc.io/docs/languages/go/quickstart/ protoc-gen-grpc-gateway Generates gRPC-gateway related .go files from proto files https://github.com/grpc-ecosystem/grpc-gateway#installation protoc-gen-openapiv2 Generates parameter files required for Swagger documentation from proto files https://github.com/grpc-ecosystem/grpc-gateway#installation buf Protobuf management tool, optional, simplifies command line operations and protobuf file management https://docs.buf.build/installation Steps Write buf configuration buf.gen.yaml\nversion: v1beta1 plugins: - name: go out: internal/proto opt: - paths=source_relative - name: go-grpc out: internal/proto opt: - paths=source_relative - require_unimplemented_servers=false - name: grpc-gateway out: internal/proto opt: - paths=source_relative - name: openapiv2 out: openapi opt: - json_names_for_fields=false buf.yaml\nversion: v1beta1 name: buf.build/myworkspace/grpc deps: - buf.build/beta/googleapis - buf.build/grpc-ecosystem/grpc-gateway build: roots: - proto lint: use: - DEFAULT rpc_allow_google_protobuf_empty_requests: true rpc_allow_google_protobuf_empty_responses: true breaking: use: - FILE Write proto Unlike standard gRPC interface proto files, this includes annotations for HTTP.\nAdd HTTP API information via gRPC options, such as HTTP method, path, body, additional bindings, etc. Requires importing google/api/annotations.proto Add extra information via protobuf message fields to implement HTTP request parameter and response body constraints, and to generate Swagger documentation. Requires importing protoc-gen-openapiv2/options/annotations.proto demo.proto\nsyntax = \"proto3\"; package console.v1; option go_package = \"git.yourcompany.com/yourgroup/grpc-gateway-demo/proto/console/v1\"; import \"google/protobuf/empty.proto\"; import \"google/api/annotations.proto\"; import \"protoc-gen-openapiv2/options/annotations.proto\"; // DemoService is the demo service definition service DemoService { rpc Hello(HelloRequest) returns (HelloResponse) { option (google.api.http) = { get: \"/web/v1/hello-messages/{name}\" additional_bindings { get: \"/client/v1/hello-messages/{name}\" } }; } } message HelloRequest { string name = 1 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = { description: \"Name\", required: ['name'], type: STRING, }]; } message HelloResponse { string message = 1 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = { description: \"Response Message\", required: ['message'], type: STRING, }]; } Generate Code Command\ngrpc.sh\n#!/usr/bin/env bash buf lint buf breaking --against .git#branch=master buf generate Directory Structure\ndemo.pb.gw.go is the file generated for gRPC-gateway, handling HTTP RESTful to gRPC requests.\ngrpc-gateway-demo/internal/proto\nqtmf-demo/internal/proto ➜ tree . └── console └── v1 ├── demo.pb.go ├── demo.pb.gw.go └── demo_grpc.pb.go Generated Swagger Documentation\n[DemoService]\nGET /web/v1/hello-messages/{name}\nGET /client/v1/hello-messages/{name}\nWrite Go RPC Service grpc/main.go\ntype DemoHandler struct{} // Hello implementation func (s *DemoHandler) Hello(ctx context.Context, request *consoleV1.HelloRequest) (*consoleV1.HelloResponse, error) { return \u0026consoleV1.HelloResponse{ Message: \"hello: \" + request.GetName(), }, nil } func main() { lis, err := net.Listen(\"tcp\", port) if err != nil { log.Fatalf(\"failed to listen: %v\", err) } s := grpc.NewServer() pb.RegisterDemoServer(s, \u0026server{}) // Register reflection service on gRPC server. reflection.Register(s) if err := s.Serve(lis); err != nil { log.Fatalf(\"failed to serve: %v\", err) } } Start Service\nmain.go\npackage main import ( \"context\" \"flag\" \"net/http\" \"github.com/golang/glog\" \"github.com/grpc-ecosystem/grpc-gateway/v2/runtime\" \"google.golang.org/grpc\" \"google.golang.org/grpc/credentials/insecure\" gw \"github.com/yourorg/yourrepo/proto/gen/go/your/service/v1/your_service\" // Update ) var ( // command-line options: // gRPC server endpoint grpcServerEndpoint = flag.String(\"grpc-server-endpoint\", \"localhost:9090\", \"gRPC server endpoint\") ) func run() error { ctx := context.Background() ctx, cancel := context.WithCancel(ctx) defer cancel() // Register gRPC server endpoint // Note: Make sure the gRPC server is running properly and accessible mux := runtime.NewServeMux() opts := []grpc.DialOption{grpc.WithTransportCredentials(insecure.NewCredentials())} err := gw.RegisterYourServiceHandlerFromEndpoint(ctx, mux, *grpcServerEndpoint, opts) if err != nil { return err } // Start HTTP server (and proxy calls to gRPC server endpoint) return http.ListenAndServe(\":8081\", mux) } func main() { flag.Parse() defer glog.Flush() if err := run(); err != nil { glog.Fatal(err) } } Principle Returning to the official diagram, it clearly shows the process of generating gRPC Service and reverse proxy from the proto file.\nSource Code Analysis gRPC-gateway is mainly divided into code generation, the generated reverse proxy, and the runtime for HTTP and gRPC protocol handling.\nCode Generation https://github.com/grpc-ecosystem/grpc-gateway/blob/master/protoc-gen-grpc-gateway/main.go#L65\nfunc main() { flag.Parse() defer glog.Flush() if *versionFlag { fmt.Printf(\"Version %v, commit %v, built at %v\\n\", version, commit, date) os.Exit(0) } protogen.Options{ ParamFunc: flag.CommandLine.Set, }.Run(func(gen *protogen.Plugin) error { reg := descriptor.NewRegistry() err := applyFlags(reg) if err != nil { return err } codegenerator.SetSupportedFeaturesOnPluginGen(gen) generator := gengateway.New(reg, *useRequestContext, *registerFuncSuffix, *allowPatchFeature, *standalone) glog.V(1).Infof(\"Parsing code generator request\") if err := reg.LoadFromPlugin(gen); err != nil { return err } unboundHTTPRules := reg.UnboundExternalHTTPRules() if len(unboundHTTPRules) != 0 { return fmt.Errorf(\"HTTP rules without a matching selector: %s\", strings.Join(unboundHTTPRules, \", \")) } var targets []*descriptor.File for _, target := range gen.Request.FileToGenerate { f, err := reg.LookupFile(target) if err != nil { return err } targets = append(targets, f) } files, err := generator.Generate(targets) for _, f := range files { glog.V(1).Infof(\"NewGeneratedFile %q in %s\", f.GetName(), f.GoPkg) genFile := gen.NewGeneratedFile(f.GetName(), protogen.GoImportPath(f.GoPkg.Path)) if _, err := genFile.Write([]byte(f.GetContent())); err != nil { return err } } glog.V(1).Info(\"Processed code generator request\") return err }) } Generated Reverse Proxy https://github.com/grpc-ecosystem/grpc-gateway/blob/master/examples/internal/helloworld/helloworld.pb.gw.go#L738\n// Handling HTTP requests func RegisterGreeterHandlerServer(ctx context.Context, mux *runtime.ServeMux, server GreeterServer) error { mux.Handle(\"GET\", pattern_Greeter_SayHello_0, func(w http.ResponseWriter, req *http.Request, pathParams map[string]string) { ctx, cancel := context.WithCancel(req.Context()) defer cancel() var stream runtime.ServerTransportStream ctx = grpc.NewContextWithServerTransportStream(ctx, \u0026stream) inboundMarshaler, outboundMarshaler := runtime.MarshalerForRequest(mux, req) rctx, err := runtime.AnnotateIncomingContext(ctx, mux, req, \"/grpc.gateway.examples.internal.helloworld.Greeter/SayHello\", runtime.WithHTTPPathPattern(\"/say/{name}\")) if err != nil { runtime.HTTPError(ctx, mux, outboundMarshaler, w, req, err) return } resp, md, err := local_request_Greeter_SayHello_0(rctx, inboundMarshaler, server, req, pathParams) md.HeaderMD, md.TrailerMD = metadata.Join(md.HeaderMD, stream.Header()), metadata.Join(md.TrailerMD, stream.Trailer()) ctx = runtime.NewServerMetadataContext(ctx, md) if err != nil { runtime.HTTPError(ctx, mux, outboundMarshaler, w, req, err) return } forward_Greeter_SayHello_0(ctx, mux, outboundMarshaler, w, req, resp, mux.GetForwardResponseOptions()...) }) // Requesting gRPC Client func request_Greeter_SayHello_0(ctx context.Context, marshaler runtime.Marshaler, client GreeterClient, req *http.Request, pathParams map[string]string) (proto.Message, runtime.ServerMetadata, error) { var protoReq HelloRequest var metadata runtime.ServerMetadata var ( val string ok bool err error _ = err ) val, ok = pathParams[\"name\"] if !ok { return nil, metadata, status.Errorf(codes.InvalidArgument, \"missing parameter %s\", \"name\") } protoReq.Name, err = runtime.String(val) if err != nil { return nil, metadata, status.Errorf(codes.InvalidArgument, \"type mismatch, parameter: %s, error: %v\", \"name\", err) } if err := req.ParseForm(); err != nil { return nil, metadata, status.Errorf(codes.InvalidArgument, \"%v\", err) } if err := runtime.PopulateQueryParameters(\u0026protoReq, req.Form, filter_Greeter_SayHello_0); err != nil { return nil, metadata, status.Errorf(codes.InvalidArgument, \"%v\", err) } msg, err := client.SayHello(ctx, \u0026protoReq, grpc.Header(\u0026metadata.HeaderMD), grpc.Trailer(\u0026metadata.TrailerMD)) return msg, metadata, err Error Mapping Converting from gRPC status code to HTTP status code\nhttps://github.com/grpc-ecosystem/grpc-gateway/blob/master/runtime/errors.go\n// HTTPStatusFromCode converts a gRPC error code into the corresponding HTTP response status. // See: https://github.com/googleapis/googleapis/blob/master/google/rpc/code.proto func HTTPStatusFromCode(code codes.Code) int { switch code { case codes.OK: return http.StatusOK case codes.Canceled: return http.StatusRequestTimeout case codes.Unknown: return http.StatusInternalServerError case codes.InvalidArgument: return http.StatusBadRequest case codes.DeadlineExceeded: return http.StatusGatewayTimeout case codes.NotFound: return http.StatusNotFound case codes.AlreadyExists: return http.StatusConflict case codes.PermissionDenied: return http.StatusForbidden case codes.Unauthenticated: return http.StatusUnauthorized case codes.ResourceExhausted: return http.StatusTooManyRequests case codes.FailedPrecondition: // Note, this deliberately doesn't translate to the similarly named '412 Precondition Failed' HTTP response status. return http.StatusBadRequest case codes.Aborted: return http.StatusConflict case codes.OutOfRange: return http.StatusBadRequest case codes.Unimplemented: return http.StatusNotImplemented case codes.Internal: return http.StatusInternalServerError case codes.Unavailable: return http.StatusServiceUnavailable case codes.DataLoss: return http.StatusInternalServerError } grpclog.Infof(\"Unknown gRPC error code: %v\", code) return http.StatusInternalServerError } References https://github.com/grpc-ecosystem/grpc-gateway#readme\nhttps://grpc-ecosystem.github.io/grpc-gateway/\nhttps://github.com/grpc/grpc-go\nhttps://grpc.io/docs/\nhttps://github.com/googleapis/googleapis/tree/master/google/api\nhttps://github.com/grpc-ecosystem/grpc-gateway/tree/master/protoc-gen-openapiv2/options\n","wordCount":"1131","inLanguage":"en","datePublished":"2022-03-13T18:13:14+08:00","dateModified":"2022-03-13T18:13:14+08:00","author":{"@type":"Person","name":"zhoukuncheng"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://zhoukuncheng.github.io/posts/go-grpc-gateway/"},"publisher":{"@type":"Organization","name":"zhoukuncheng's Personal Blog","logo":{"@type":"ImageObject","url":"https://zhoukuncheng.github.io/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://zhoukuncheng.github.io/ accesskey=h title="zhoukuncheng's Personal Blog (Alt + H)">zhoukuncheng's Personal Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://zhoukuncheng.github.io/zh/ title=中文 aria-label=中文>Zh</a></li></ul></div></div><ul id=menu><li><a href=https://zhoukuncheng.github.io/ title=Home><span>Home</span></a></li><li><a href=https://zhoukuncheng.github.io/posts/ title=Archive><span>Archive</span></a></li><li><a href=https://zhoukuncheng.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://zhoukuncheng.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://zhoukuncheng.github.io/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Developing RESTful APIs with gRPC-Gateway</h1><div class=post-meta><span title='2022-03-13 18:13:14 +0800 +0800'>March 13, 2022</span>&nbsp;·&nbsp;<span>zhoukuncheng</span>&nbsp;|&nbsp;<span>Translations:</span><ul class=i18n_list><li><a href=https://zhoukuncheng.github.io/zh/posts/go-grpc-gateway/>Zh</a></li></ul></div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#introduction-to-grpc-gateway aria-label="Introduction to gRPC-Gateway">Introduction to gRPC-Gateway</a></li><li><a href=#installation-and-usage aria-label="Installation and Usage">Installation and Usage</a><ul><li><a href=#dependencies aria-label=Dependencies>Dependencies</a></li><li><a href=#steps aria-label=Steps>Steps</a><ul><li><a href=#write-buf-configuration aria-label="Write buf configuration">Write buf configuration</a></li><li><a href=#write-proto aria-label="Write proto">Write proto</a></li><li><a href=#generate-code aria-label="Generate Code">Generate Code</a></li><li><a href=#write-go-rpc-service aria-label="Write Go RPC Service">Write Go RPC Service</a></li></ul></li></ul></li><li><a href=#principle aria-label=Principle>Principle</a><ul><li><a href=#source-code-analysis aria-label="Source Code Analysis">Source Code Analysis</a><ul><li><a href=#code-generation aria-label="Code Generation">Code Generation</a></li><li><a href=#generated-reverse-proxy aria-label="Generated Reverse Proxy">Generated Reverse Proxy</a></li><li><a href=#error-mapping aria-label="Error Mapping">Error Mapping</a></li></ul></li></ul></li><li><a href=#references aria-label=References>References</a></li></ul></div></details></div><div class=post-content><h2 id=introduction-to-grpc-gateway>Introduction to gRPC-Gateway<a hidden class=anchor aria-hidden=true href=#introduction-to-grpc-gateway>#</a></h2><p>gRPC-Gateway is a plugin for <code>protoc</code>. It works by reading a gRPC service definition and generating a reverse proxy server that translates a RESTful JSON API into gRPC.</p><p>This server is generated according to the custom options in your gRPC definition.<br><img loading=lazy src=https://grpc-ecosystem.github.io/grpc-gateway/assets/images/architecture_introduction_diagram.svg></p><h2 id=installation-and-usage>Installation and Usage<a hidden class=anchor aria-hidden=true href=#installation-and-usage>#</a></h2><h3 id=dependencies>Dependencies<a hidden class=anchor aria-hidden=true href=#dependencies>#</a></h3><table><thead><tr><th style=text-align:left>Tool</th><th style=text-align:left>Introduction</th><th style=text-align:left>Installation</th></tr></thead><tbody><tr><td style=text-align:left>protobuf</td><td style=text-align:left>Command line tool for protocol buffer compilation</td><td style=text-align:left><a href=http://google.github.io/proto-lens/installing-protoc.html>http://google.github.io/proto-lens/installing-protoc.html</a></td></tr><tr><td style=text-align:left>protoc-gen-go</td><td style=text-align:left>Generates .go files from proto files</td><td style=text-align:left><a href=https://grpc.io/docs/languages/go/quickstart/>https://grpc.io/docs/languages/go/quickstart/</a></td></tr><tr><td style=text-align:left>protoc-gen-go-grpc</td><td style=text-align:left>Generates gRPC related .go files from proto files</td><td style=text-align:left><a href=https://grpc.io/docs/languages/go/quickstart/>https://grpc.io/docs/languages/go/quickstart/</a></td></tr><tr><td style=text-align:left>protoc-gen-grpc-gateway</td><td style=text-align:left>Generates gRPC-gateway related .go files from proto files</td><td style=text-align:left><a href=https://github.com/grpc-ecosystem/grpc-gateway#installation>https://github.com/grpc-ecosystem/grpc-gateway#installation</a></td></tr><tr><td style=text-align:left>protoc-gen-openapiv2</td><td style=text-align:left>Generates parameter files required for Swagger documentation from proto files</td><td style=text-align:left><a href=https://github.com/grpc-ecosystem/grpc-gateway#installation>https://github.com/grpc-ecosystem/grpc-gateway#installation</a></td></tr><tr><td style=text-align:left>buf</td><td style=text-align:left>Protobuf management tool, optional, simplifies command line operations and protobuf file management</td><td style=text-align:left><a href=https://docs.buf.build/installation>https://docs.buf.build/installation</a></td></tr></tbody></table><h3 id=steps>Steps<a hidden class=anchor aria-hidden=true href=#steps>#</a></h3><h4 id=write-buf-configuration>Write buf configuration<a hidden class=anchor aria-hidden=true href=#write-buf-configuration>#</a></h4><p><code>buf.gen.yaml</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=l>v1beta1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>plugins</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>go</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>out</span><span class=p>:</span><span class=w> </span><span class=l>internal/proto</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>opt</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>paths=source_relative</span><span class=w>
</span></span></span><span class=line><span class=cl>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>go-grpc</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>out</span><span class=p>:</span><span class=w> </span><span class=l>internal/proto</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>opt</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>paths=source_relative</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>require_unimplemented_servers=false</span><span class=w>
</span></span></span><span class=line><span class=cl>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>grpc-gateway</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>out</span><span class=p>:</span><span class=w> </span><span class=l>internal/proto</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>opt</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>paths=source_relative</span><span class=w>
</span></span></span><span class=line><span class=cl>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>openapiv2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>out</span><span class=p>:</span><span class=w> </span><span class=l>openapi</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>opt</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>json_names_for_fields=false</span><span class=w>
</span></span></span></code></pre></div><p><code>buf.yaml</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=l>v1beta1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>buf.build/myworkspace/grpc</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>deps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl>- <span class=l>buf.build/beta/googleapis</span><span class=w>
</span></span></span><span class=line><span class=cl>- <span class=l>buf.build/grpc-ecosystem/grpc-gateway</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>build</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>roots</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>proto</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>lint</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>use</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>DEFAULT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>rpc_allow_google_protobuf_empty_requests</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>rpc_allow_google_protobuf_empty_responses</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>breaking</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>use</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>FILE</span><span class=w>
</span></span></span></code></pre></div><h4 id=write-proto>Write proto<a hidden class=anchor aria-hidden=true href=#write-proto>#</a></h4><p>Unlike standard gRPC interface proto files, this includes annotations for HTTP.</p><ul><li>Add HTTP API information via gRPC options, such as HTTP method, path, body, additional bindings, etc. Requires importing <a href=https://github.com/googleapis/googleapis/blob/master/google/api/annotations.proto>google/api/annotations.proto</a></li><li>Add extra information via protobuf message fields to implement HTTP request parameter and response body constraints, and to generate Swagger documentation. Requires importing <a href=https://github.com/grpc-ecosystem/grpc-gateway/blob/master/protoc-gen-openapiv2/options/annotations.proto>protoc-gen-openapiv2/options/annotations.proto</a></li></ul><p><code>demo.proto</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-protobuf data-lang=protobuf><span class=line><span class=cl><span class=n>syntax</span> <span class=o>=</span> <span class=s>&#34;proto3&#34;</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl> <span class=err>
</span></span></span><span class=line><span class=cl><span class=kn>package</span> <span class=nn>console</span><span class=o>.</span><span class=n>v1</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=k>option</span> <span class=n>go_package</span> <span class=o>=</span> <span class=s>&#34;git.yourcompany.com/yourgroup/grpc-gateway-demo/proto/console/v1&#34;</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl> <span class=err>
</span></span></span><span class=line><span class=cl><span class=k>import</span> <span class=s>&#34;google/protobuf/empty.proto&#34;</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=k>import</span> <span class=s>&#34;google/api/annotations.proto&#34;</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=k>import</span> <span class=s>&#34;protoc-gen-openapiv2/options/annotations.proto&#34;</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl> <span class=err>
</span></span></span><span class=line><span class=cl><span class=c1>// DemoService is the demo service definition
</span></span></span><span class=line><span class=cl><span class=kd>service</span> <span class=n>DemoService</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl>    <span class=k>rpc</span> <span class=n>Hello</span><span class=p>(</span><span class=n>HelloRequest</span><span class=p>)</span> <span class=k>returns</span> <span class=p>(</span><span class=n>HelloResponse</span><span class=p>)</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl>        <span class=k>option</span> <span class=p>(</span><span class=n>google.api.http</span><span class=p>)</span> <span class=o>=</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl>            <span class=n>get</span><span class=o>:</span> <span class=s>&#34;/web/v1/hello-messages/{name}&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl>            <span class=n>additional_bindings</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl>                <span class=n>get</span><span class=o>:</span> <span class=s>&#34;/client/v1/hello-messages/{name}&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl>            <span class=p>}</span><span class=err>
</span></span></span><span class=line><span class=cl>        <span class=p>};</span><span class=err>
</span></span></span><span class=line><span class=cl>    <span class=p>}</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=err>
</span></span></span><span class=line><span class=cl> <span class=err>
</span></span></span><span class=line><span class=cl><span class=kd>message</span> <span class=nc>HelloRequest</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl>    <span class=kt>string</span> <span class=n>name</span> <span class=o>=</span> <span class=mi>1</span> <span class=p>[(</span><span class=n>grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field</span><span class=p>)</span> <span class=o>=</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl>        <span class=n>description</span><span class=o>:</span> <span class=s>&#34;Name&#34;</span><span class=p>,</span><span class=err>
</span></span></span><span class=line><span class=cl>        <span class=k>required</span><span class=o>:</span> <span class=p>[</span><span class=s>&#39;name&#39;</span><span class=p>],</span><span class=err>
</span></span></span><span class=line><span class=cl>        <span class=n>type</span><span class=o>:</span> <span class=n>STRING</span><span class=p>,</span><span class=err>
</span></span></span><span class=line><span class=cl>    <span class=p>}];</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=err>
</span></span></span><span class=line><span class=cl> <span class=err>
</span></span></span><span class=line><span class=cl><span class=kd>message</span> <span class=nc>HelloResponse</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl>    <span class=kt>string</span> <span class=kd>message</span> <span class=o>=</span> <span class=mi>1</span> <span class=p>[(</span><span class=n>grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field</span><span class=p>)</span> <span class=o>=</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl>        <span class=n>description</span><span class=o>:</span> <span class=s>&#34;Response Message&#34;</span><span class=p>,</span><span class=err>
</span></span></span><span class=line><span class=cl>        <span class=k>required</span><span class=o>:</span> <span class=p>[</span><span class=s>&#39;message&#39;</span><span class=p>],</span><span class=err>
</span></span></span><span class=line><span class=cl>        <span class=n>type</span><span class=o>:</span> <span class=n>STRING</span><span class=p>,</span><span class=err>
</span></span></span><span class=line><span class=cl>    <span class=p>}];</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=err>
</span></span></span></code></pre></div><h4 id=generate-code>Generate Code<a hidden class=anchor aria-hidden=true href=#generate-code>#</a></h4><p>Command</p><p><code>grpc.sh</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/usr/bin/env bash
</span></span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>buf lint
</span></span><span class=line><span class=cl>buf breaking --against .git#branch<span class=o>=</span>master
</span></span><span class=line><span class=cl>buf generate
</span></span></code></pre></div><p>Directory Structure</p><p><code>demo.pb.gw.go</code> is the file generated for gRPC-gateway, handling HTTP RESTful to gRPC requests.</p><p><code>grpc-gateway-demo/internal/proto</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>qtmf-demo/internal/proto
</span></span><span class=line><span class=cl>➜ tree
</span></span><span class=line><span class=cl>.
</span></span><span class=line><span class=cl>└── console
</span></span><span class=line><span class=cl>  └── v1
</span></span><span class=line><span class=cl>    ├── demo.pb.go
</span></span><span class=line><span class=cl>    ├── demo.pb.gw.go
</span></span><span class=line><span class=cl>    └── demo_grpc.pb.go
</span></span></code></pre></div><p>Generated Swagger Documentation</p><p><strong>[DemoService]</strong></p><p><strong>GET</strong> /web/v1/hello-messages/{name}</p><p><strong>GET</strong> /client/v1/hello-messages/{name}</p><h4 id=write-go-rpc-service>Write Go RPC Service<a hidden class=anchor aria-hidden=true href=#write-go-rpc-service>#</a></h4><p><code>grpc/main.go</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>type</span><span class=w> </span><span class=nx>DemoHandler</span><span class=w> </span><span class=kd>struct</span><span class=p>{}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=c1>// Hello implementation</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>s</span><span class=w> </span><span class=o>*</span><span class=nx>DemoHandler</span><span class=p>)</span><span class=w> </span><span class=nf>Hello</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span><span class=w> </span><span class=nx>request</span><span class=w> </span><span class=o>*</span><span class=nx>consoleV1</span><span class=p>.</span><span class=nx>HelloRequest</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=o>*</span><span class=nx>consoleV1</span><span class=p>.</span><span class=nx>HelloResponse</span><span class=p>,</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=o>&amp;</span><span class=nx>consoleV1</span><span class=p>.</span><span class=nx>HelloResponse</span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>Message</span><span class=p>:</span><span class=w> </span><span class=s>&#34;hello: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>request</span><span class=p>.</span><span class=nf>GetName</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>},</span><span class=w> </span><span class=kc>nil</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>func</span><span class=w> </span><span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>lis</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>net</span><span class=p>.</span><span class=nf>Listen</span><span class=p>(</span><span class=s>&#34;tcp&#34;</span><span class=p>,</span><span class=w> </span><span class=nx>port</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=nx>log</span><span class=p>.</span><span class=nf>Fatalf</span><span class=p>(</span><span class=s>&#34;failed to listen: %v&#34;</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>s</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>grpc</span><span class=p>.</span><span class=nf>NewServer</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>pb</span><span class=p>.</span><span class=nf>RegisterDemoServer</span><span class=p>(</span><span class=nx>s</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=nx>server</span><span class=p>{})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// Register reflection service on gRPC server.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>reflection</span><span class=p>.</span><span class=nf>Register</span><span class=p>(</span><span class=nx>s</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>s</span><span class=p>.</span><span class=nf>Serve</span><span class=p>(</span><span class=nx>lis</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=nx>log</span><span class=p>.</span><span class=nf>Fatalf</span><span class=p>(</span><span class=s>&#34;failed to serve: %v&#34;</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>Start Service</p><p><code>main.go</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nx>main</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> 
</span></span></span><span class=line><span class=cl><span class=kn>import</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=s>&#34;context&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=s>&#34;flag&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=s>&#34;net/http&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=s>&#34;github.com/golang/glog&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=s>&#34;github.com/grpc-ecosystem/grpc-gateway/v2/runtime&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=s>&#34;google.golang.org/grpc&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=s>&#34;google.golang.org/grpc/credentials/insecure&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nx>gw</span><span class=w> </span><span class=s>&#34;github.com/yourorg/yourrepo/proto/gen/go/your/service/v1/your_service&#34;</span><span class=w>  </span><span class=c1>// Update</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> 
</span></span></span><span class=line><span class=cl><span class=kd>var</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c1>// command-line options:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c1>// gRPC server endpoint</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nx>grpcServerEndpoint</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>flag</span><span class=p>.</span><span class=nf>String</span><span class=p>(</span><span class=s>&#34;grpc-server-endpoint&#34;</span><span class=p>,</span><span class=w>  </span><span class=s>&#34;localhost:9090&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;gRPC server endpoint&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> 
</span></span></span><span class=line><span class=cl><span class=kd>func</span><span class=w> </span><span class=nf>run</span><span class=p>()</span><span class=w> </span><span class=kt>error</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nx>ctx</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>context</span><span class=p>.</span><span class=nf>Background</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nx>ctx</span><span class=p>,</span><span class=w> </span><span class=nx>cancel</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>context</span><span class=p>.</span><span class=nf>WithCancel</span><span class=p>(</span><span class=nx>ctx</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>defer</span><span class=w> </span><span class=nf>cancel</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c1>// Register gRPC server endpoint</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c1>// Note: Make sure the gRPC server is running properly and accessible</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nx>mux</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>runtime</span><span class=p>.</span><span class=nf>NewServeMux</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nx>opts</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=p>[]</span><span class=nx>grpc</span><span class=p>.</span><span class=nx>DialOption</span><span class=p>{</span><span class=nx>grpc</span><span class=p>.</span><span class=nf>WithTransportCredentials</span><span class=p>(</span><span class=nx>insecure</span><span class=p>.</span><span class=nf>NewCredentials</span><span class=p>())}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>gw</span><span class=p>.</span><span class=nf>RegisterYourServiceHandlerFromEndpoint</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span><span class=w> </span><span class=nx>mux</span><span class=p>,</span><span class=w>  </span><span class=o>*</span><span class=nx>grpcServerEndpoint</span><span class=p>,</span><span class=w> </span><span class=nx>opts</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>err</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c1>// Start HTTP server (and proxy calls to gRPC server endpoint)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=nx>http</span><span class=p>.</span><span class=nf>ListenAndServe</span><span class=p>(</span><span class=s>&#34;:8081&#34;</span><span class=p>,</span><span class=w> </span><span class=nx>mux</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> 
</span></span></span><span class=line><span class=cl><span class=kd>func</span><span class=w> </span><span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nx>flag</span><span class=p>.</span><span class=nf>Parse</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>defer</span><span class=w> </span><span class=nx>glog</span><span class=p>.</span><span class=nf>Flush</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nf>run</span><span class=p>();</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>glog</span><span class=p>.</span><span class=nf>Fatal</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h2 id=principle>Principle<a hidden class=anchor aria-hidden=true href=#principle>#</a></h2><p>Returning to the official diagram, it clearly shows the process of generating gRPC Service and reverse proxy from the proto file.</p><p><img loading=lazy src=https://grpc-ecosystem.github.io/grpc-gateway/assets/images/architecture_introduction_diagram.svg></p><h3 id=source-code-analysis>Source Code Analysis<a hidden class=anchor aria-hidden=true href=#source-code-analysis>#</a></h3><p>gRPC-gateway is mainly divided into code generation, the generated reverse proxy, and the runtime for HTTP and gRPC protocol handling.</p><h4 id=code-generation>Code Generation<a hidden class=anchor aria-hidden=true href=#code-generation>#</a></h4><p><a href=https://github.com/grpc-ecosystem/grpc-gateway/blob/master/protoc-gen-grpc-gateway/main.go#L65>https://github.com/grpc-ecosystem/grpc-gateway/blob/master/protoc-gen-grpc-gateway/main.go#L65</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span><span class=w> </span><span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>flag</span><span class=p>.</span><span class=nf>Parse</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>defer</span><span class=w> </span><span class=nx>glog</span><span class=p>.</span><span class=nf>Flush</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>*</span><span class=nx>versionFlag</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Version %v, commit %v, built at %v\n&#34;</span><span class=p>,</span><span class=w> </span><span class=nx>version</span><span class=p>,</span><span class=w> </span><span class=nx>commit</span><span class=p>,</span><span class=w> </span><span class=nx>date</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>os</span><span class=p>.</span><span class=nf>Exit</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>protogen</span><span class=p>.</span><span class=nx>Options</span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>ParamFunc</span><span class=p>:</span><span class=w> </span><span class=nx>flag</span><span class=p>.</span><span class=nx>CommandLine</span><span class=p>.</span><span class=nx>Set</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}.</span><span class=nf>Run</span><span class=p>(</span><span class=kd>func</span><span class=p>(</span><span class=nx>gen</span><span class=w> </span><span class=o>*</span><span class=nx>protogen</span><span class=p>.</span><span class=nx>Plugin</span><span class=p>)</span><span class=w> </span><span class=kt>error</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>reg</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>descriptor</span><span class=p>.</span><span class=nf>NewRegistry</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nf>applyFlags</span><span class=p>(</span><span class=nx>reg</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=nx>err</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>codegenerator</span><span class=p>.</span><span class=nf>SetSupportedFeaturesOnPluginGen</span><span class=p>(</span><span class=nx>gen</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>generator</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>gengateway</span><span class=p>.</span><span class=nf>New</span><span class=p>(</span><span class=nx>reg</span><span class=p>,</span><span class=w> </span><span class=o>*</span><span class=nx>useRequestContext</span><span class=p>,</span><span class=w> </span><span class=o>*</span><span class=nx>registerFuncSuffix</span><span class=p>,</span><span class=w> </span><span class=o>*</span><span class=nx>allowPatchFeature</span><span class=p>,</span><span class=w> </span><span class=o>*</span><span class=nx>standalone</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>glog</span><span class=p>.</span><span class=nf>V</span><span class=p>(</span><span class=mi>1</span><span class=p>).</span><span class=nf>Infof</span><span class=p>(</span><span class=s>&#34;Parsing code generator request&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>reg</span><span class=p>.</span><span class=nf>LoadFromPlugin</span><span class=p>(</span><span class=nx>gen</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=nx>err</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>unboundHTTPRules</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>reg</span><span class=p>.</span><span class=nf>UnboundExternalHTTPRules</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>unboundHTTPRules</span><span class=p>)</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=nx>fmt</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=s>&#34;HTTP rules without a matching selector: %s&#34;</span><span class=p>,</span><span class=w> </span><span class=nx>strings</span><span class=p>.</span><span class=nf>Join</span><span class=p>(</span><span class=nx>unboundHTTPRules</span><span class=p>,</span><span class=w> </span><span class=s>&#34;, &#34;</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>var</span><span class=w> </span><span class=nx>targets</span><span class=w> </span><span class=p>[]</span><span class=o>*</span><span class=nx>descriptor</span><span class=p>.</span><span class=nx>File</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>target</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>gen</span><span class=p>.</span><span class=nx>Request</span><span class=p>.</span><span class=nx>FileToGenerate</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nx>f</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>reg</span><span class=p>.</span><span class=nf>LookupFile</span><span class=p>(</span><span class=nx>target</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=nx>err</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nx>targets</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nb>append</span><span class=p>(</span><span class=nx>targets</span><span class=p>,</span><span class=w> </span><span class=nx>f</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>files</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>generator</span><span class=p>.</span><span class=nf>Generate</span><span class=p>(</span><span class=nx>targets</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>f</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>files</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nx>glog</span><span class=p>.</span><span class=nf>V</span><span class=p>(</span><span class=mi>1</span><span class=p>).</span><span class=nf>Infof</span><span class=p>(</span><span class=s>&#34;NewGeneratedFile %q in %s&#34;</span><span class=p>,</span><span class=w> </span><span class=nx>f</span><span class=p>.</span><span class=nf>GetName</span><span class=p>(),</span><span class=w> </span><span class=nx>f</span><span class=p>.</span><span class=nx>GoPkg</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nx>genFile</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>gen</span><span class=p>.</span><span class=nf>NewGeneratedFile</span><span class=p>(</span><span class=nx>f</span><span class=p>.</span><span class=nf>GetName</span><span class=p>(),</span><span class=w> </span><span class=nx>protogen</span><span class=p>.</span><span class=nf>GoImportPath</span><span class=p>(</span><span class=nx>f</span><span class=p>.</span><span class=nx>GoPkg</span><span class=p>.</span><span class=nx>Path</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>genFile</span><span class=p>.</span><span class=nf>Write</span><span class=p>([]</span><span class=nb>byte</span><span class=p>(</span><span class=nx>f</span><span class=p>.</span><span class=nf>GetContent</span><span class=p>()));</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=nx>err</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>glog</span><span class=p>.</span><span class=nf>V</span><span class=p>(</span><span class=mi>1</span><span class=p>).</span><span class=nf>Info</span><span class=p>(</span><span class=s>&#34;Processed code generator request&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>err</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h4 id=generated-reverse-proxy>Generated Reverse Proxy<a hidden class=anchor aria-hidden=true href=#generated-reverse-proxy>#</a></h4><p><a href=https://github.com/grpc-ecosystem/grpc-gateway/blob/master/examples/internal/helloworld/helloworld.pb.gw.go#L738>https://github.com/grpc-ecosystem/grpc-gateway/blob/master/examples/internal/helloworld/helloworld.pb.gw.go#L738</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// Handling HTTP requests</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>func</span><span class=w> </span><span class=nf>RegisterGreeterHandlerServer</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span><span class=w> </span><span class=nx>mux</span><span class=w> </span><span class=o>*</span><span class=nx>runtime</span><span class=p>.</span><span class=nx>ServeMux</span><span class=p>,</span><span class=w> </span><span class=nx>server</span><span class=w> </span><span class=nx>GreeterServer</span><span class=p>)</span><span class=w> </span><span class=kt>error</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>mux</span><span class=p>.</span><span class=nf>Handle</span><span class=p>(</span><span class=s>&#34;GET&#34;</span><span class=p>,</span><span class=w> </span><span class=nx>pattern_Greeter_SayHello_0</span><span class=p>,</span><span class=w> </span><span class=kd>func</span><span class=p>(</span><span class=nx>w</span><span class=w> </span><span class=nx>http</span><span class=p>.</span><span class=nx>ResponseWriter</span><span class=p>,</span><span class=w> </span><span class=nx>req</span><span class=w> </span><span class=o>*</span><span class=nx>http</span><span class=p>.</span><span class=nx>Request</span><span class=p>,</span><span class=w> </span><span class=nx>pathParams</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>ctx</span><span class=p>,</span><span class=w> </span><span class=nx>cancel</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>context</span><span class=p>.</span><span class=nf>WithCancel</span><span class=p>(</span><span class=nx>req</span><span class=p>.</span><span class=nf>Context</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>defer</span><span class=w> </span><span class=nf>cancel</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>var</span><span class=w> </span><span class=nx>stream</span><span class=w> </span><span class=nx>runtime</span><span class=p>.</span><span class=nx>ServerTransportStream</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>ctx</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>grpc</span><span class=p>.</span><span class=nf>NewContextWithServerTransportStream</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=nx>stream</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>inboundMarshaler</span><span class=p>,</span><span class=w> </span><span class=nx>outboundMarshaler</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>runtime</span><span class=p>.</span><span class=nf>MarshalerForRequest</span><span class=p>(</span><span class=nx>mux</span><span class=p>,</span><span class=w> </span><span class=nx>req</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>rctx</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>runtime</span><span class=p>.</span><span class=nf>AnnotateIncomingContext</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span><span class=w> </span><span class=nx>mux</span><span class=p>,</span><span class=w> </span><span class=nx>req</span><span class=p>,</span><span class=w> </span><span class=s>&#34;/grpc.gateway.examples.internal.helloworld.Greeter/SayHello&#34;</span><span class=p>,</span><span class=w> </span><span class=nx>runtime</span><span class=p>.</span><span class=nf>WithHTTPPathPattern</span><span class=p>(</span><span class=s>&#34;/say/{name}&#34;</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nx>runtime</span><span class=p>.</span><span class=nf>HTTPError</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span><span class=w> </span><span class=nx>mux</span><span class=p>,</span><span class=w> </span><span class=nx>outboundMarshaler</span><span class=p>,</span><span class=w> </span><span class=nx>w</span><span class=p>,</span><span class=w> </span><span class=nx>req</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>resp</span><span class=p>,</span><span class=w> </span><span class=nx>md</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nf>local_request_Greeter_SayHello_0</span><span class=p>(</span><span class=nx>rctx</span><span class=p>,</span><span class=w> </span><span class=nx>inboundMarshaler</span><span class=p>,</span><span class=w> </span><span class=nx>server</span><span class=p>,</span><span class=w> </span><span class=nx>req</span><span class=p>,</span><span class=w> </span><span class=nx>pathParams</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>md</span><span class=p>.</span><span class=nx>HeaderMD</span><span class=p>,</span><span class=w> </span><span class=nx>md</span><span class=p>.</span><span class=nx>TrailerMD</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>metadata</span><span class=p>.</span><span class=nf>Join</span><span class=p>(</span><span class=nx>md</span><span class=p>.</span><span class=nx>HeaderMD</span><span class=p>,</span><span class=w> </span><span class=nx>stream</span><span class=p>.</span><span class=nf>Header</span><span class=p>()),</span><span class=w> </span><span class=nx>metadata</span><span class=p>.</span><span class=nf>Join</span><span class=p>(</span><span class=nx>md</span><span class=p>.</span><span class=nx>TrailerMD</span><span class=p>,</span><span class=w> </span><span class=nx>stream</span><span class=p>.</span><span class=nf>Trailer</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>ctx</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>runtime</span><span class=p>.</span><span class=nf>NewServerMetadataContext</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span><span class=w> </span><span class=nx>md</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nx>runtime</span><span class=p>.</span><span class=nf>HTTPError</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span><span class=w> </span><span class=nx>mux</span><span class=p>,</span><span class=w> </span><span class=nx>outboundMarshaler</span><span class=p>,</span><span class=w> </span><span class=nx>w</span><span class=p>,</span><span class=w> </span><span class=nx>req</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nf>forward_Greeter_SayHello_0</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span><span class=w> </span><span class=nx>mux</span><span class=p>,</span><span class=w> </span><span class=nx>outboundMarshaler</span><span class=p>,</span><span class=w> </span><span class=nx>w</span><span class=p>,</span><span class=w> </span><span class=nx>req</span><span class=p>,</span><span class=w> </span><span class=nx>resp</span><span class=p>,</span><span class=w> </span><span class=nx>mux</span><span class=p>.</span><span class=nf>GetForwardResponseOptions</span><span class=p>()</span><span class=o>...</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w> 
</span></span></span><span class=line><span class=cl><span class=c1>// Requesting gRPC Client</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>func</span><span class=w> </span><span class=nf>request_Greeter_SayHello_0</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span><span class=w> </span><span class=nx>marshaler</span><span class=w> </span><span class=nx>runtime</span><span class=p>.</span><span class=nx>Marshaler</span><span class=p>,</span><span class=w> </span><span class=nx>client</span><span class=w> </span><span class=nx>GreeterClient</span><span class=p>,</span><span class=w> </span><span class=nx>req</span><span class=w> </span><span class=o>*</span><span class=nx>http</span><span class=p>.</span><span class=nx>Request</span><span class=p>,</span><span class=w> </span><span class=nx>pathParams</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=nx>proto</span><span class=p>.</span><span class=nx>Message</span><span class=p>,</span><span class=w> </span><span class=nx>runtime</span><span class=p>.</span><span class=nx>ServerMetadata</span><span class=p>,</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=nx>protoReq</span><span class=w> </span><span class=nx>HelloRequest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=nx>metadata</span><span class=w> </span><span class=nx>runtime</span><span class=p>.</span><span class=nx>ServerMetadata</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>var</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>val</span><span class=w> </span><span class=kt>string</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>ok</span><span class=w>  </span><span class=kt>bool</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>_</span><span class=w>   </span><span class=p>=</span><span class=w> </span><span class=nx>err</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>val</span><span class=p>,</span><span class=w> </span><span class=nx>ok</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>pathParams</span><span class=p>[</span><span class=s>&#34;name&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>!</span><span class=nx>ok</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>metadata</span><span class=p>,</span><span class=w> </span><span class=nx>status</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=nx>codes</span><span class=p>.</span><span class=nx>InvalidArgument</span><span class=p>,</span><span class=w> </span><span class=s>&#34;missing parameter %s&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;name&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>protoReq</span><span class=p>.</span><span class=nx>Name</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>runtime</span><span class=p>.</span><span class=nf>String</span><span class=p>(</span><span class=nx>val</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>metadata</span><span class=p>,</span><span class=w> </span><span class=nx>status</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=nx>codes</span><span class=p>.</span><span class=nx>InvalidArgument</span><span class=p>,</span><span class=w> </span><span class=s>&#34;type mismatch, parameter: %s, error: %v&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;name&#34;</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>req</span><span class=p>.</span><span class=nf>ParseForm</span><span class=p>();</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>metadata</span><span class=p>,</span><span class=w> </span><span class=nx>status</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=nx>codes</span><span class=p>.</span><span class=nx>InvalidArgument</span><span class=p>,</span><span class=w> </span><span class=s>&#34;%v&#34;</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>runtime</span><span class=p>.</span><span class=nf>PopulateQueryParameters</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>protoReq</span><span class=p>,</span><span class=w> </span><span class=nx>req</span><span class=p>.</span><span class=nx>Form</span><span class=p>,</span><span class=w> </span><span class=nx>filter_Greeter_SayHello_0</span><span class=p>);</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=p>,</span><span class=w> </span><span class=nx>metadata</span><span class=p>,</span><span class=w> </span><span class=nx>status</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=nx>codes</span><span class=p>.</span><span class=nx>InvalidArgument</span><span class=p>,</span><span class=w> </span><span class=s>&#34;%v&#34;</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>msg</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>client</span><span class=p>.</span><span class=nf>SayHello</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=nx>protoReq</span><span class=p>,</span><span class=w> </span><span class=nx>grpc</span><span class=p>.</span><span class=nf>Header</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>metadata</span><span class=p>.</span><span class=nx>HeaderMD</span><span class=p>),</span><span class=w> </span><span class=nx>grpc</span><span class=p>.</span><span class=nf>Trailer</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>metadata</span><span class=p>.</span><span class=nx>TrailerMD</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>msg</span><span class=p>,</span><span class=w> </span><span class=nx>metadata</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w>
</span></span></span></code></pre></div><h4 id=error-mapping>Error Mapping<a hidden class=anchor aria-hidden=true href=#error-mapping>#</a></h4><p>Converting from gRPC status code to HTTP status code</p><p><a href=https://github.com/grpc-ecosystem/grpc-gateway/blob/master/runtime/errors.go>https://github.com/grpc-ecosystem/grpc-gateway/blob/master/runtime/errors.go</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// HTTPStatusFromCode converts a gRPC error code into the corresponding HTTP response status.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=c1>// See: https://github.com/googleapis/googleapis/blob/master/google/rpc/code.proto</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>func</span><span class=w> </span><span class=nf>HTTPStatusFromCode</span><span class=p>(</span><span class=nx>code</span><span class=w> </span><span class=nx>codes</span><span class=p>.</span><span class=nx>Code</span><span class=p>)</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>switch</span><span class=w> </span><span class=nx>code</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=nx>codes</span><span class=p>.</span><span class=nx>OK</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=nx>codes</span><span class=p>.</span><span class=nx>Canceled</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusRequestTimeout</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=nx>codes</span><span class=p>.</span><span class=nx>Unknown</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=nx>codes</span><span class=p>.</span><span class=nx>InvalidArgument</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusBadRequest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=nx>codes</span><span class=p>.</span><span class=nx>DeadlineExceeded</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusGatewayTimeout</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=nx>codes</span><span class=p>.</span><span class=nx>NotFound</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusNotFound</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=nx>codes</span><span class=p>.</span><span class=nx>AlreadyExists</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusConflict</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=nx>codes</span><span class=p>.</span><span class=nx>PermissionDenied</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusForbidden</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=nx>codes</span><span class=p>.</span><span class=nx>Unauthenticated</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusUnauthorized</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=nx>codes</span><span class=p>.</span><span class=nx>ResourceExhausted</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusTooManyRequests</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=nx>codes</span><span class=p>.</span><span class=nx>FailedPrecondition</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// Note, this deliberately doesn&#39;t translate to the similarly named &#39;412 Precondition Failed&#39; HTTP response status.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusBadRequest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=nx>codes</span><span class=p>.</span><span class=nx>Aborted</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusConflict</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=nx>codes</span><span class=p>.</span><span class=nx>OutOfRange</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusBadRequest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=nx>codes</span><span class=p>.</span><span class=nx>Unimplemented</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusNotImplemented</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=nx>codes</span><span class=p>.</span><span class=nx>Internal</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=nx>codes</span><span class=p>.</span><span class=nx>Unavailable</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusServiceUnavailable</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>case</span><span class=w> </span><span class=nx>codes</span><span class=p>.</span><span class=nx>DataLoss</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>grpclog</span><span class=p>.</span><span class=nf>Infof</span><span class=p>(</span><span class=s>&#34;Unknown gRPC error code: %v&#34;</span><span class=p>,</span><span class=w> </span><span class=nx>code</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h2 id=references>References<a hidden class=anchor aria-hidden=true href=#references>#</a></h2><p><a href=https://github.com/grpc-ecosystem/grpc-gateway#readme>https://github.com/grpc-ecosystem/grpc-gateway#readme</a></p><p><a href=https://grpc-ecosystem.github.io/grpc-gateway/>https://grpc-ecosystem.github.io/grpc-gateway/</a></p><p><a href=https://github.com/grpc/grpc-go>https://github.com/grpc/grpc-go</a></p><p><a href=https://grpc.io/docs/>https://grpc.io/docs/</a></p><p><a href=https://github.com/googleapis/googleapis/tree/master/google/api>https://github.com/googleapis/googleapis/tree/master/google/api</a></p><p><a href=https://github.com/grpc-ecosystem/grpc-gateway/tree/master/protoc-gen-openapiv2/options>https://github.com/grpc-ecosystem/grpc-gateway/tree/master/protoc-gen-openapiv2/options</a></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://zhoukuncheng.github.io/tags/golang/>Golang</a></li><li><a href=https://zhoukuncheng.github.io/tags/web/>Web</a></li><li><a href=https://zhoukuncheng.github.io/tags/grpc/>GRPC</a></li><li><a href=https://zhoukuncheng.github.io/tags/grpc-gateway/>GRPC-Gateway</a></li></ul></footer><script src=https://giscus.app/client.js data-repo=zhoukuncheng/zhoukuncheng.github.io data-repo-id="MDEwOlJlcG9zaXRvcnkyODIxMTA1OTU=" data-category=General data-category-id=DIC_kwDOENCqg84Cexta data-mapping=og:title data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=purple_dark data-lang=en crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2025 <a href=https://zhoukuncheng.github.io/>zhoukuncheng's Personal Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script></body></html>