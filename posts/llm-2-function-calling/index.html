<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>LLM Learning Series 2. Function Calling | zhoukuncheng's Personal Blog</title>
<meta name=keywords content="LLM,function calling"><meta name=description content='Introduction For typical LLM interactions, a single prompt or a few rounds of chat are sufficient to achieve the desired result. However, some tasks require the LLM to access information beyond its internal knowledge base. For example, retrieving today&rsquo;s weather information for a specific city or searching for a particular anime necessitates calling external functions. What is Function Calling? Function calling in LLMs empowers the models to generate JSON objects that trigger external functions within your code. This capability enables LLMs to connect with external tools and APIs, expanding their ability to perform diverse tasks. Function Calling Execution Steps User calls LLM API with tools and a user prompt: The user provides a prompt and specifies the available tools. What is the weather like in San Francisco? Define Tool Schema tools = [ { "type": "function", "function": { "name": "get_current_weather", "description": "Get the current weather in a given location", "parameters": { "type": "object", "properties": { "location": { "type": "string", "description": "The city and state, e.g. San Francisco, CA", }, "unit": { "type": "string", "enum": ["celsius", "fahrenheit"]}, }, "required": ["location"], }, }, } ] Define Dummy Function # Example function hard coded to return the same weather def get_current_weather(location, unit="fahrenheit"): """Get'><meta name=author content><link rel=canonical href=https://zhoukuncheng.github.io/posts/llm-2-function-calling/><link crossorigin=anonymous href=/assets/css/stylesheet.5cfc680b1eeaeef9efbced92d46c2a9e876b72ee14fba85846afc4cff9e6e6f8.css integrity="sha256-XPxoCx7q7vnvvO2S1Gwqnodrcu4U+6hYRq/Ez/nm5vg=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://zhoukuncheng.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://zhoukuncheng.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://zhoukuncheng.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://zhoukuncheng.github.io/apple-touch-icon.png><link rel=mask-icon href=https://zhoukuncheng.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://zhoukuncheng.github.io/posts/llm-2-function-calling/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-GH88YSLNJN"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-GH88YSLNJN")}</script><meta property="og:title" content="LLM Learning Series 2. Function Calling"><meta property="og:description" content='Introduction For typical LLM interactions, a single prompt or a few rounds of chat are sufficient to achieve the desired result. However, some tasks require the LLM to access information beyond its internal knowledge base. For example, retrieving today&rsquo;s weather information for a specific city or searching for a particular anime necessitates calling external functions. What is Function Calling? Function calling in LLMs empowers the models to generate JSON objects that trigger external functions within your code. This capability enables LLMs to connect with external tools and APIs, expanding their ability to perform diverse tasks. Function Calling Execution Steps User calls LLM API with tools and a user prompt: The user provides a prompt and specifies the available tools. What is the weather like in San Francisco? Define Tool Schema tools = [ { "type": "function", "function": { "name": "get_current_weather", "description": "Get the current weather in a given location", "parameters": { "type": "object", "properties": { "location": { "type": "string", "description": "The city and state, e.g. San Francisco, CA", }, "unit": { "type": "string", "enum": ["celsius", "fahrenheit"]}, }, "required": ["location"], }, }, } ] Define Dummy Function # Example function hard coded to return the same weather def get_current_weather(location, unit="fahrenheit"): """Get'><meta property="og:type" content="article"><meta property="og:url" content="https://zhoukuncheng.github.io/posts/llm-2-function-calling/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-05-05T16:11:34+08:00"><meta property="article:modified_time" content="2024-05-05T16:11:34+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="LLM Learning Series 2. Function Calling"><meta name=twitter:description content='Introduction For typical LLM interactions, a single prompt or a few rounds of chat are sufficient to achieve the desired result. However, some tasks require the LLM to access information beyond its internal knowledge base. For example, retrieving today&rsquo;s weather information for a specific city or searching for a particular anime necessitates calling external functions. What is Function Calling? Function calling in LLMs empowers the models to generate JSON objects that trigger external functions within your code. This capability enables LLMs to connect with external tools and APIs, expanding their ability to perform diverse tasks. Function Calling Execution Steps User calls LLM API with tools and a user prompt: The user provides a prompt and specifies the available tools. What is the weather like in San Francisco? Define Tool Schema tools = [ { "type": "function", "function": { "name": "get_current_weather", "description": "Get the current weather in a given location", "parameters": { "type": "object", "properties": { "location": { "type": "string", "description": "The city and state, e.g. San Francisco, CA", }, "unit": { "type": "string", "enum": ["celsius", "fahrenheit"]}, }, "required": ["location"], }, }, } ] Define Dummy Function # Example function hard coded to return the same weather def get_current_weather(location, unit="fahrenheit"): """Get'><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://zhoukuncheng.github.io/posts/"},{"@type":"ListItem","position":2,"name":"LLM Learning Series 2. Function Calling","item":"https://zhoukuncheng.github.io/posts/llm-2-function-calling/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"LLM Learning Series 2. Function Calling","name":"LLM Learning Series 2. Function Calling","description":"Introduction For typical LLM interactions, a single prompt or a few rounds of chat are sufficient to achieve the desired result. However, some tasks require the LLM to access information beyond its internal knowledge base. For example, retrieving today\u0026rsquo;s weather information for a specific city or searching for a particular anime necessitates calling external functions. What is Function Calling? Function calling in LLMs empowers the models to generate JSON objects that trigger external functions within your code. This capability enables LLMs to connect with external tools and APIs, expanding their ability to perform diverse tasks. Function Calling Execution Steps User calls LLM API with tools and a user prompt: The user provides a prompt and specifies the available tools. What is the weather like in San Francisco? Define Tool Schema tools = [ { \u0026#34;type\u0026#34;: \u0026#34;function\u0026#34;, \u0026#34;function\u0026#34;: { \u0026#34;name\u0026#34;: \u0026#34;get_current_weather\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;Get the current weather in a given location\u0026#34;, \u0026#34;parameters\u0026#34;: { \u0026#34;type\u0026#34;: \u0026#34;object\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;location\u0026#34;: { \u0026#34;type\u0026#34;: \u0026#34;string\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;The city and state, e.g. San Francisco, CA\u0026#34;, }, \u0026#34;unit\u0026#34;: { \u0026#34;type\u0026#34;: \u0026#34;string\u0026#34;, \u0026#34;enum\u0026#34;: [\u0026#34;celsius\u0026#34;, \u0026#34;fahrenheit\u0026#34;]}, }, \u0026#34;required\u0026#34;: [\u0026#34;location\u0026#34;], }, }, } ] Define Dummy Function # Example function hard coded to return the same weather def get_current_weather(location, unit=\u0026#34;fahrenheit\u0026#34;): \u0026#34;\u0026#34;\u0026#34;Get","keywords":["LLM","function calling"],"articleBody":"Introduction For typical LLM interactions, a single prompt or a few rounds of chat are sufficient to achieve the desired result. However, some tasks require the LLM to access information beyond its internal knowledge base. For example, retrieving today’s weather information for a specific city or searching for a particular anime necessitates calling external functions.\nWhat is Function Calling? Function calling in LLMs empowers the models to generate JSON objects that trigger external functions within your code. This capability enables LLMs to connect with external tools and APIs, expanding their ability to perform diverse tasks.\nFunction Calling Execution Steps User calls LLM API with tools and a user prompt: The user provides a prompt and specifies the available tools.\nWhat is the weather like in San Francisco? Define Tool Schema\ntools = [ { \"type\": \"function\", \"function\": { \"name\": \"get_current_weather\", \"description\": \"Get the current weather in a given location\", \"parameters\": { \"type\": \"object\", \"properties\": { \"location\": { \"type\": \"string\", \"description\": \"The city and state, e.g. San Francisco, CA\", }, \"unit\": { \"type\": \"string\", \"enum\": [\"celsius\", \"fahrenheit\"]}, }, \"required\": [\"location\"], }, }, } ] Define Dummy Function\n# Example function hard coded to return the same weather def get_current_weather(location, unit=\"fahrenheit\"): \"\"\"Get the current weather in a given location\"\"\" if \"tokyo\" in location.lower(): return json.dumps({\"location\": \"Tokyo\", \"temperature\": \"10\", \"unit\": unit}) elif \"san francisco\" in location.lower(): return json.dumps({\"location\": \"San Francisco\", \"temperature\": \"72\", \"unit\": unit}) elif \"paris\" in location.lower(): return json.dumps({\"location\": \"Paris\", \"temperature\": \"22\", \"unit\": unit}) else: return json.dumps({\"location\": location, \"temperature\": \"unknown\"}) LLM chooses tools The LLM analyzes the prompt and available tools, then selects the appropriate tool to fulfill the request.\nCreate ChatCompletion with Tools\ndef get_completion(messages, model=\"gpt-4-turbo\", temperature=0, max_tokens=300, tools=None): response = openai.chat.completions.create( model=model, messages=messages, temperature=temperature, max_tokens=max_tokens, tools=tools ) return response.choices[0].message Response with tools\nChatCompletionMessage(content=None, role='assistant', function_call=None, tool_calls=[ChatCompletionMessageToolCall(id='...', function=Function(arguments='{\"location\":\"San Francisco\",\"unit\":\"celsius\"}', name='get_current_weather'), type='function')]) Run code of chosen tools and return results The selected tool’s code is executed on client side, and the results are returned to the LLM.\nLLM combines prompt and results, and returns final response The LLM incorporates the retrieved information with the initial prompt to generate a comprehensive and informative final response.\nAn Example: Searching for Anime Python Code import json import os import pprint import httpx from openai import AzureOpenAI def search_anime(keyword: str) -\u003e str: url = \"https://api.bgm.tv/v0/search/subjects\" querystring = {\"limit\": \"3\"} payload = { \"keyword\": keyword, \"filter\": { \"type\": [2], \"rating\": [\"\u003e=7\"], \"nsfw\": False } } headers = { \"Content-Type\": \"application/json\" } with httpx.Client() as client: response = client.request(\"POST\", url, json=payload, headers=headers, params=querystring) return response.text client = AzureOpenAI( azure_endpoint=os.getenv(\"AZURE_OPENAI_ENDPOINT\"), api_key=os.getenv(\"AZURE_OPENAI_API_KEY\"), api_version=\"2024-03-01-preview\" ) def run_conversation(query: str): # Step 1: send the conversation and available functions to the model messages = [{\"role\": \"user\", \"content\": query, }] tools = [ { \"type\": \"function\", \"function\": { \"name\": \"search_anime\", \"description\": \"Search for an anime using the Bangumi API\", \"parameters\": { \"type\": \"object\", \"properties\": { \"keyword\": { \"type\": \"string\", \"description\": \"The keyword to search for, e.g. '攻殻機動隊' or 'EVA'\", }, }, \"required\": [\"keyword\"], }, }, } ] response = client.chat.completions.create( model=MODEL_DEPLOYMENT_NAME, messages=messages, tools=tools, tool_choice=\"auto\", # auto is default, but we'll be explicit ) response_message = response.choices[0].message tool_calls = response_message.tool_calls print(\"------First Response------\") pprint.pprint(response_message) # Step 2: check if the model wanted to call a function if tool_calls: # Step 3: call the function # Note: the JSON response may not always be valid; be sure to handle errors available_functions = { \"search_anime\": search_anime, } # only one function in this example, but you can have multiple messages.append(response_message) # extend conversation with assistant's reply # Step 4: send the info for each function call and function response to the model for tool_call in tool_calls: function_name = tool_call.function.name function_to_call = available_functions[function_name] function_args = json.loads(tool_call.function.arguments) function_response = function_to_call( keyword=function_args.get(\"keyword\"), ) messages.append( { \"tool_call_id\": tool_call.id, \"role\": \"tool\", \"name\": function_name, \"content\": function_response, } ) # extend conversation with function response print(\"------Call Tool Messages------\") pprint.pprint(messages) second_response = client.chat.completions.create( model=MODEL_DEPLOYMENT_NAME, messages=messages, ) # get a new response from the model where it can see the function response return second_response if __name__ == \"__main__\": MODEL_DEPLOYMENT_NAME = \"gpt-4\" anime = \"EVA\" resp = run_conversation( f\"Search for the anime and summarize its story, tags, ratings, etc. Use English.: {anime=}\" ) print(\"------Second Response------\") pprint.pprint(resp) print(\"------Content------\") print(resp.choices[0].message.content) Internal Message Structure ------First Response------ ChatCompletionMessage(content=None, role='assistant', function_call=None, tool_calls=[ChatCompletionMessageToolCall(id='call_E1s6hI3fsPNyaJH0pJfFnYmD', function=Function(arguments='{\"keyword\": \"EVA\"}', name='search_anime'), type='function')]) ------Call Tool Messages------ [{'content': 'Search for the anime and summarize its story, tags, ratings, ' \"etc. Use English.: anime='EVA'\", 'role': 'user'}, ChatCompletionMessage(content=None, role='assistant', function_call=None, tool_calls=[ChatCompletionMessageToolCall(id='call_E1s6hI3fsPNyaJH0pJfFnYmD', function=Function(arguments='{\"keyword\": \"EVA\"}', name='search_anime'), type='function')]), {'content': '{\"data\":[{\"date\":\"1995-10-04\",\"image\":\"https://lain.bgm.tv/pic/cover/l/e5/69/265_Z5Uou.jpg\",\"type\":2,\"summary\":\"\\u3000\\u3000' '2000年，一个科学探险队在南极洲针对被称作“第一使徒”亚当的“光之巨人”进行探险。在对其进行接触实验时，“光之巨人”自毁，从而发生了“第二次冲击”，进而导致 世界大战。最后，人类人口减半，地轴偏转、气候改变。根据对“第二次冲击”的调查，联合国在日本箱根成立人工进化研究所（即 ' 'GEHIRN）从事EVA（指机器人）的发展研究，后GEHIRN利用在人工进化研究所下方发现的巨大空洞建造了总部。\\\\r\\\\n\\u3000\\u3000' '另一方面，联合国下属秘密组织SEELE为了使人类进化，开始实行人类补完计划，就是将所有人的灵魂汇集在一起，通过中和每个人的AT力场，使每个人回归LCL之海。\\\\r\\\\n\\u3000\\u3000' '2004年，EVA初号机进行启动试验时发生事故，碇真嗣的母亲碇唯消失，碇源渡开始执行“碇源渡版本的人类补完计划”。2010年，GEHIRN被改建成NERV。\\\\r\\\\n\\u3000\\u3000' \"2015年开始，根据SEELE人类补完计划剧本的安排，一种巨型人形生物“使徒”开始在日本登陆，并向NERV总部进攻，NERV组织EVA消灭使徒。在NERV与使徒作战的同时， 碇源渡秘密地执行它自己的计划。随着时间推移，碇源渡的计划逐渐被SEELE发现，NERV与SEELE产生了矛盾并不断恶化。\\\\r\\\\nDirector's \" 'Cut版本的第21～24集由剧场版《Death》篇剪辑而成，收录在20周年纪念版的蓝光中。\",\"name\":\"新世紀エヴァンゲリオン\",\"name_cn\":\"新世纪福音战士\",\"tags\":[{\" name\":\"EVA\",\"count\":7833},{\"name\":\"庵野秀明\",\"count\":5809},{\"name\":\"GAINAX\",\"count\":3751},{\"name\":\"新世纪福音战士\",\"count\":3377},{\"name\":\"神作\",\"count\":2847},{\"n ame\":\"科幻\",\"count\":2635},{\"name\":\"宗教\",\"count\":1832},{\"name\":\"TV\",\"count\":1778},{\"name\":\"心理\",\"count\":1414},{\"name\":\"1995\",\"count\":1157},{\"name\":\"骗钱神棍片的 者\",\"count\":1044},{\"name\":\"原创\",\"count\":936},{\"name\":\"补完\",\"count\":798},{\"name\":\"凌波\",\"count\":703},{\"name\":\"Evangelion\",\"count\":620},{\"name\":\"圣经\",\"count\": : 353},{\"name\":\"神棍\",\"count\":237},{\"name\":\"1995年10月\",\"count\":206},{\"name\":\"机战\",\"count\":181},{\"name\":\"萝卜\",\"count\":180},{\"name\":\"战斗\",\"count\":141},{\"name\":\" 经典\",\"count\":111},{\"name\":\"意识流\",\"count\":106},{\"name\":\"贞本义行\",\"count\":77},{\"name\":\"明日香\",\"count\":62},{\"name\":\"1995年\",\"count\":53},{\"name\":\"生命中的哀伤与 忆\",\"count\":53},{\"name\":\"龙之子Production\",\"count\":50},{\"name\":\"童年\",\"count\":47},{\"name\":\"日本\",\"count\":43}],\"score\":8.8,\"id\":265,\"rank\":9},{\"date\":\"\",\"image\" \":\"\",\"type\":2,\"summary\":\"半年前，早在为《EVA新剧场版》造势的时候，Bandai ' '就公布了以Q版COLLECTION FIGURE开端，讲述发生在NERV学院中的一段段恩怨情仇的《DEFORMER ' 'EVA（デフォルメエヴァ）》FIGURE企划第一弹，EVA2007春季攻势-校园剧《ぷちえヴぁ EVANGELION @ ' 'SCHOOL》，并拍成了动画短篇。绫波三姐妹，红龙明日香，万年受真嗣，以及越熟越可爱的葛成美里姐姐，不，老师，还有身处黑暗中的学校不良少年王 ' '“EVA长”（友情客串：初号机）。整套玩偶共分9套，包括8套公开版本和一个SECRET版本。\",\"name\":\"EVA爆笑校园\",\"name_cn\":\"\",\"tags\":[{\"name\":\"EVA\",\"count\":5} ,{\"name\":\"额\",\"count\":2},{\"name\":\"Q版劇\",\"count\":1}],\"score\":7.3,\"id\":3387,\"rank\":0},{\"date\":\"2012-11-17\",\"image\":\"https://lain.bgm.tv/pic/cover/l/69/63/61290_9O TjL.jpg\",\"type\":2,\"summary\":\"近第3次冲击”过后的第14年，世界依然血红。无数类似EVA01的生命徘徊在补完未完成的世界。NERV分裂，Wille的出现，碇源堂和Seele的计划，如约 在行。《死海文书》的预言也到了尽头，新轮回的开始注定源于毁灭。取出“卡西乌斯枪”和“朗基努斯枪”，解除14年来的处于“莉莉丝”周围的结界和封印，成为命运的牵绊：渚熏和碇 真嗣，终将驾驶EVA13与生死离别……\",\"name\":\"EVA ' ':Q\",\"name_cn\":\"新世纪福音战士剧场版：Q\",\"tags\":[],\"score\":7,\"id\":61290,\"rank\":0}],\"total\":17,\"limit\":3,\"offset\":0}\\n', 'name': 'search_anime', 'role': 'tool', 'tool_call_id': 'call_E1s6hI3fsPNyaJH0pJfFnYmD'}] ------Second Response------ ChatCompletion(id='chatcmpl-9LS1xyK6B9Q47bSZKzBjFftIsZk27', choices=[Choice(finish_reason='stop', index=0, logprobs=None, message=ChatCompletionMessage(content=' ### 1. Neon Genesis Evangelion (新世紀エヴァンゲリオン)\\n\\n- **Original Name:** 新世紀エヴァンゲリオン\\n- **English Name:** Neon Genesis Evangelion\\n- **Date Rel eased:** 1995-10-04\\n- **Type:** TV Series\\n- **Summary:** In the year 2000, a scientific expedition in Antarctica exploring the \"Giant of Light\" known as \"Adam\" triggers the \"Second Impact,\" leading to a devastating world war, climate change, and a halved human population. GEHIRN, which later becomes NERV, is establishe d to develop Evangelions (EVA) to combat giant beings known as \"Angels.\" The series follows the battles of the EVAs against the Angels, interwoven with complex t hemes of religion, psychology, and human relationships.\\n- **Tags:** EVA, Hideaki Anno, GAINAX, science fiction, religion, psychology, original, combat, classic, existential\\n- **Score:** 8.8\\n- **Rank:** 9\\n- [Link to more information](https://lain.bgm.tv/pic/cover/l/e5/69/265_Z5Uou.jpg)\\n\\n### 2. EVA Laughing Schoolyar d (EVA爆笑校园)\\n\\n- **Original Name:** EVA爆笑校园\\n- **Date Released:** Unspecified\\n- **Type:** Project\\n- **Summary:** An initiative by Bandai ahead of \"EVA New Theatre Edition,\" starting with Q-version COLLECTION FIGURE, it narrates the relationships and rivalries within the NERV Academy through animated shorts. It features a playful and cute take on the characters from the original Evangelion series.\\n- **Tags:** EVA, Q-version drama\\n- **Score:** 7.3\\n\\n### 3. EVA :Q (新 世纪福音战士剧场版：Q)\\n\\n- **Original Name:** EVA :Q\\n- **English Name:** Neon Genesis Evangelion: Q\\n- **Date Released:** 2012-11-17\\n- **Type:** Film\\n- **Sum mary:** Set 14 years after the \"nearly 3rd Impact,\" the world is still reeling from its incomplete state. With the splintering of NERV and the emergence of Wille , the stage is set for the fulfillment of Gendo Ikari and Seele\\'s plans, alongside the prophecies of the Dead Sea Scrolls. Shinji and Kaworu navigate a world on the brink of a new cycle, ultimately piloting EVA Unit-13 towards a fateful confrontation.\\n- **Score:** 7.0\\n\\nPlease note that the details provided, especiall y for the second entry \"EVA Laughing Schoolyard,\" are rather limited, and the focus primarily lies on toy figures and a lighter, humorous take on the original Ev angelion universe.', role='assistant', function_call=None, tool_calls=None), content_filter_results={'hate': {'filtered': False, 'severity': 'safe'}, 'self_harm' : {'filtered': False, 'severity': 'safe'}, 'sexual': {'filtered': False, 'severity': 'safe'}, 'violence': {'filtered': False, 'severity': 'safe'}})], created=171 4899665, model='gpt-4', object='chat.completion', system_fingerprint='fp_2f57f81c11', usage=CompletionUsage(completion_tokens=621, prompt_tokens=1736, total_toke ns=2357), prompt_filter_results=[{'prompt_index': 0, 'content_filter_results': {'hate': {'filtered': False, 'severity': 'safe'}, 'self_harm': {'filtered': False, 'severity': 'safe'}, 'sexual': {'filtered': False, 'severity': 'safe'}, 'violence': {'filtered': False, 'severity': 'safe'}}}]) Example Output 1. Neon Genesis Evangelion (新世紀エヴァンゲリオン) Original Name: 新世紀エヴァンゲリオン English Name: Neon Genesis Evangelion Date Released: 1995-10-04 Type: TV Series Summary: In the year 2000, a scientific expedition in Antarctica exploring the “Giant of Light” known as “Adam” triggers the “Second Impact,” leading to a devastating world war, climate change, and a halved human population. GEHIRN, which later becomes NERV, is established to develop Evangelions (EVA) to combat gia nt beings known as “Angels.” The series follows the battles of the EVAs against the Angels, interwoven with complex themes of religion, psychology, and human relationships. Tags: EVA, Hideaki Anno, GAINAX, science fiction, religion, psychology, original, combat, classic, existential Score: 8.8 Rank: 9 Link to more information 2. EVA Laughing Schoolyard (EVA爆笑校园) Original Name: EVA爆笑校园 Date Released: Unspecified Type: Project Summary: An initiative by Bandai ahead of “EVA New Theatre Edition,” starting with Q-version COLLECTION FIGURE, it narrates the relationships and rivalries within the NERV Academy through animated shorts. It features a playful and cute take on the characters from the original Evangelion series. Tags: EVA, Q-version drama Score: 7.3 3. EVA :Q (新世纪福音战士剧场版：Q) Original Name: EVA :Q English Name: Neon Genesis Evangelion: Q Date Released: 2012-11-17 Type: Film Summary: Set 14 years after the “nearly 3rd Impact,” the world is still reeling from its incomplete state. With the splintering of NERV and the emergence o f Wille, the stage is set for the fulfillment of Gendo Ikari and Seele’s plans, alongside the prophecies of the Dead Sea Scrolls. Shinji and Kaworu navigate a world on the brink of a new cycle, ultimately piloting EVA Unit-13 towards a fateful confrontation. Score: 7.0 Please note that the details provided, especially for the second entry “EVA Laughing Schoolyard,” are rather limited, and the focus primarily lies on toy figures and a lighter, humorous take on the original Evangelion universe.\nReferences https://platform.openai.com/docs/guides/function-calling\nhttps://cookbook.openai.com/examples/how_to_call_functions_with_chat_models\nhttps://docs.anthropic.com/claude/docs/tool-use\nhttps://www.promptingguide.ai/applications/function_calling\nhttps://learn.microsoft.com/en-us/azure/ai-services/openai/how-to/function-calling?tabs=python\n","wordCount":"5151","inLanguage":"en","datePublished":"2024-05-05T16:11:34+08:00","dateModified":"2024-05-05T16:11:34+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://zhoukuncheng.github.io/posts/llm-2-function-calling/"},"publisher":{"@type":"Organization","name":"zhoukuncheng's Personal Blog","logo":{"@type":"ImageObject","url":"https://zhoukuncheng.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://zhoukuncheng.github.io/ accesskey=h title="zhoukuncheng's Personal Blog (Alt + H)">zhoukuncheng's Personal Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=https://zhoukuncheng.github.io/ title=Home><span>Home</span></a></li><li><a href=https://zhoukuncheng.github.io/posts/ title=Archive><span>Archive</span></a></li><li><a href=https://zhoukuncheng.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://zhoukuncheng.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://zhoukuncheng.github.io/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>LLM Learning Series 2. Function Calling</h1><div class=post-meta><span title='2024-05-05 16:11:34 +0800 +0800'>May 5, 2024</span></div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#introduction aria-label=Introduction>Introduction</a><ul><li><a href=#what-is-function-calling aria-label="What is Function Calling?">What is Function Calling?</a><ul><li><a href=#function-calling-execution-steps aria-label="Function Calling Execution Steps">Function Calling Execution Steps</a></li></ul></li></ul></li><li><a href=#an-example-searching-for-anime aria-label="An Example: Searching for Anime">An Example: Searching for Anime</a><ul><li><a href=#python-code aria-label="Python Code">Python Code</a></li><li><a href=#internal-message-structure aria-label="Internal Message Structure">Internal Message Structure</a></li><li><a href=#example-output aria-label="Example Output">Example Output</a><ul><li><a href=#1-neon-genesis-evangelion-%e6%96%b0%e4%b8%96%e7%b4%80%e3%82%a8%e3%83%b4%e3%82%a1%e3%83%b3%e3%82%b2%e3%83%aa%e3%82%aa%e3%83%b3 aria-label="1. Neon Genesis Evangelion (新世紀エヴァンゲリオン)">1. Neon Genesis Evangelion (新世紀エヴァンゲリオン)</a></li><li><a href=#2-eva-laughing-schoolyard-eva%e7%88%86%e7%ac%91%e6%a0%a1%e5%9b%ad aria-label="2. EVA Laughing Schoolyard (EVA爆笑校园)">2. EVA Laughing Schoolyard (EVA爆笑校园)</a></li><li><a href=#3-eva-q-%e6%96%b0%e4%b8%96%e7%ba%aa%e7%a6%8f%e9%9f%b3%e6%88%98%e5%a3%ab%e5%89%a7%e5%9c%ba%e7%89%88q aria-label="3. EVA :Q (新世纪福音战士剧场版：Q)">3. EVA :Q (新世纪福音战士剧场版：Q)</a></li></ul></li></ul></li><li><a href=#references aria-label=References>References</a></li></ul></div></details></div><div class=post-content><h2 id=introduction>Introduction<a hidden class=anchor aria-hidden=true href=#introduction>#</a></h2><p>For typical LLM interactions, a single prompt or a few rounds of chat are sufficient to achieve the desired result. However, some tasks require the LLM to access information beyond its internal knowledge base. For example, retrieving today&rsquo;s weather information for a specific city or searching for a particular anime necessitates calling external functions.</p><h3 id=what-is-function-calling>What is Function Calling?<a hidden class=anchor aria-hidden=true href=#what-is-function-calling>#</a></h3><p>Function calling in LLMs empowers the models to generate JSON objects that trigger external functions within your code. This capability enables LLMs to connect with external tools and APIs, expanding their ability to perform diverse tasks.</p><h4 id=function-calling-execution-steps>Function Calling Execution Steps<a hidden class=anchor aria-hidden=true href=#function-calling-execution-steps>#</a></h4><ol><li><strong>User calls LLM API with tools and a user prompt:</strong></li></ol><p>The user provides a prompt and specifies the available tools.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>What is the weather like in San Francisco?
</span></span></code></pre></div><p>Define Tool Schema</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>tools</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;function&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;function&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;get_current_weather&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;description&#34;</span><span class=p>:</span> <span class=s2>&#34;Get the current weather in a given location&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;parameters&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;object&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;properties&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;location&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;string&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;description&#34;</span><span class=p>:</span> <span class=s2>&#34;The city and state, e.g. San Francisco, CA&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=p>},</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;unit&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;string&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;enum&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;celsius&#34;</span><span class=p>,</span> <span class=s2>&#34;fahrenheit&#34;</span><span class=p>]},</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;required&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;location&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>   
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></div><p>Define Dummy Function</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Example function hard coded to return the same weather</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_current_weather</span><span class=p>(</span><span class=n>location</span><span class=p>,</span> <span class=n>unit</span><span class=o>=</span><span class=s2>&#34;fahrenheit&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Get the current weather in a given location&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=s2>&#34;tokyo&#34;</span> <span class=ow>in</span> <span class=n>location</span><span class=o>.</span><span class=n>lower</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>({</span><span class=s2>&#34;location&#34;</span><span class=p>:</span> <span class=s2>&#34;Tokyo&#34;</span><span class=p>,</span> <span class=s2>&#34;temperature&#34;</span><span class=p>:</span> <span class=s2>&#34;10&#34;</span><span class=p>,</span> <span class=s2>&#34;unit&#34;</span><span class=p>:</span> <span class=n>unit</span><span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=s2>&#34;san francisco&#34;</span> <span class=ow>in</span> <span class=n>location</span><span class=o>.</span><span class=n>lower</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>({</span><span class=s2>&#34;location&#34;</span><span class=p>:</span> <span class=s2>&#34;San Francisco&#34;</span><span class=p>,</span> <span class=s2>&#34;temperature&#34;</span><span class=p>:</span> <span class=s2>&#34;72&#34;</span><span class=p>,</span> <span class=s2>&#34;unit&#34;</span><span class=p>:</span> <span class=n>unit</span><span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=s2>&#34;paris&#34;</span> <span class=ow>in</span> <span class=n>location</span><span class=o>.</span><span class=n>lower</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>({</span><span class=s2>&#34;location&#34;</span><span class=p>:</span> <span class=s2>&#34;Paris&#34;</span><span class=p>,</span> <span class=s2>&#34;temperature&#34;</span><span class=p>:</span> <span class=s2>&#34;22&#34;</span><span class=p>,</span> <span class=s2>&#34;unit&#34;</span><span class=p>:</span> <span class=n>unit</span><span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>({</span><span class=s2>&#34;location&#34;</span><span class=p>:</span> <span class=n>location</span><span class=p>,</span> <span class=s2>&#34;temperature&#34;</span><span class=p>:</span> <span class=s2>&#34;unknown&#34;</span><span class=p>})</span>
</span></span></code></pre></div><ol start=2><li><strong>LLM chooses tools</strong></li></ol><p>The LLM analyzes the prompt and available tools, then selects the appropriate tool to fulfill the request.</p><p>Create ChatCompletion with Tools</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_completion</span><span class=p>(</span><span class=n>messages</span><span class=p>,</span> <span class=n>model</span><span class=o>=</span><span class=s2>&#34;gpt-4-turbo&#34;</span><span class=p>,</span> <span class=n>temperature</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=n>max_tokens</span><span class=o>=</span><span class=mi>300</span><span class=p>,</span> <span class=n>tools</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>response</span> <span class=o>=</span> <span class=n>openai</span><span class=o>.</span><span class=n>chat</span><span class=o>.</span><span class=n>completions</span><span class=o>.</span><span class=n>create</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>model</span><span class=o>=</span><span class=n>model</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>messages</span><span class=o>=</span><span class=n>messages</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>temperature</span><span class=o>=</span><span class=n>temperature</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>max_tokens</span><span class=o>=</span><span class=n>max_tokens</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>tools</span><span class=o>=</span><span class=n>tools</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>response</span><span class=o>.</span><span class=n>choices</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>message</span>
</span></span></code></pre></div><p>Response with tools</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>ChatCompletionMessage</span><span class=p>(</span><span class=n>content</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>role</span><span class=o>=</span><span class=s1>&#39;assistant&#39;</span><span class=p>,</span> <span class=n>function_call</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>tool_calls</span><span class=o>=</span><span class=p>[</span><span class=n>ChatCompletionMessageToolCall</span><span class=p>(</span><span class=nb>id</span><span class=o>=</span><span class=s1>&#39;...&#39;</span><span class=p>,</span> <span class=n>function</span><span class=o>=</span><span class=n>Function</span><span class=p>(</span><span class=n>arguments</span><span class=o>=</span><span class=s1>&#39;{&#34;location&#34;:&#34;San Francisco&#34;,&#34;unit&#34;:&#34;celsius&#34;}&#39;</span><span class=p>,</span> <span class=n>name</span><span class=o>=</span><span class=s1>&#39;get_current_weather&#39;</span><span class=p>),</span> <span class=nb>type</span><span class=o>=</span><span class=s1>&#39;function&#39;</span><span class=p>)])</span>
</span></span></code></pre></div><ol start=3><li><strong>Run code of chosen tools and return results</strong></li></ol><p>The selected tool&rsquo;s code is executed on client side, and the results are returned to the LLM.</p><ol><li><strong>LLM combines prompt and results, and returns final response</strong></li></ol><p>The LLM incorporates the retrieved information with the initial prompt to generate a comprehensive and informative final response.</p><h2 id=an-example-searching-for-anime>An Example: Searching for Anime<a hidden class=anchor aria-hidden=true href=#an-example-searching-for-anime>#</a></h2><h3 id=python-code>Python Code<a hidden class=anchor aria-hidden=true href=#python-code>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pprint</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>httpx</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>openai</span> <span class=kn>import</span> <span class=n>AzureOpenAI</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>search_anime</span><span class=p>(</span><span class=n>keyword</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>url</span> <span class=o>=</span> <span class=s2>&#34;https://api.bgm.tv/v0/search/subjects&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>querystring</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;limit&#34;</span><span class=p>:</span> <span class=s2>&#34;3&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>payload</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;keyword&#34;</span><span class=p>:</span> <span class=n>keyword</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;filter&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=p>[</span><span class=mi>2</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;rating&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;&gt;=7&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;nsfw&#34;</span><span class=p>:</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>headers</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Content-Type&#34;</span><span class=p>:</span> <span class=s2>&#34;application/json&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>httpx</span><span class=o>.</span><span class=n>Client</span><span class=p>()</span> <span class=k>as</span> <span class=n>client</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>response</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=n>request</span><span class=p>(</span><span class=s2>&#34;POST&#34;</span><span class=p>,</span> <span class=n>url</span><span class=p>,</span> <span class=n>json</span><span class=o>=</span><span class=n>payload</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>,</span> <span class=n>params</span><span class=o>=</span><span class=n>querystring</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>response</span><span class=o>.</span><span class=n>text</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>client</span> <span class=o>=</span> <span class=n>AzureOpenAI</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>azure_endpoint</span><span class=o>=</span><span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>&#34;AZURE_OPENAI_ENDPOINT&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>api_key</span><span class=o>=</span><span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>&#34;AZURE_OPENAI_API_KEY&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>api_version</span><span class=o>=</span><span class=s2>&#34;2024-03-01-preview&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>run_conversation</span><span class=p>(</span><span class=n>query</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># Step 1: send the conversation and available functions to the model</span>
</span></span><span class=line><span class=cl>    <span class=n>messages</span> <span class=o>=</span> <span class=p>[{</span><span class=s2>&#34;role&#34;</span><span class=p>:</span> <span class=s2>&#34;user&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                 <span class=s2>&#34;content&#34;</span><span class=p>:</span> <span class=n>query</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                 <span class=p>}]</span>
</span></span><span class=line><span class=cl>    <span class=n>tools</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;function&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;function&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;search_anime&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;description&#34;</span><span class=p>:</span> <span class=s2>&#34;Search for an anime using the Bangumi API&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;parameters&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;object&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;properties&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;keyword&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                            <span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;string&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                            <span class=s2>&#34;description&#34;</span><span class=p>:</span> <span class=s2>&#34;The keyword to search for, e.g. &#39;攻殻機動隊&#39; or &#39;EVA&#39;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=p>},</span>
</span></span><span class=line><span class=cl>                    <span class=p>},</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;required&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;keyword&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>response</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=n>chat</span><span class=o>.</span><span class=n>completions</span><span class=o>.</span><span class=n>create</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>model</span><span class=o>=</span><span class=n>MODEL_DEPLOYMENT_NAME</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>messages</span><span class=o>=</span><span class=n>messages</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>tools</span><span class=o>=</span><span class=n>tools</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>tool_choice</span><span class=o>=</span><span class=s2>&#34;auto&#34;</span><span class=p>,</span>  <span class=c1># auto is default, but we&#39;ll be explicit</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>response_message</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>choices</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>message</span>
</span></span><span class=line><span class=cl>    <span class=n>tool_calls</span> <span class=o>=</span> <span class=n>response_message</span><span class=o>.</span><span class=n>tool_calls</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;------First Response------&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>pprint</span><span class=o>.</span><span class=n>pprint</span><span class=p>(</span><span class=n>response_message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Step 2: check if the model wanted to call a function</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>tool_calls</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># Step 3: call the function</span>
</span></span><span class=line><span class=cl>        <span class=c1># Note: the JSON response may not always be valid; be sure to handle errors</span>
</span></span><span class=line><span class=cl>        <span class=n>available_functions</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;search_anime&#34;</span><span class=p>:</span> <span class=n>search_anime</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>  <span class=c1># only one function in this example, but you can have multiple</span>
</span></span><span class=line><span class=cl>        <span class=n>messages</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>response_message</span><span class=p>)</span>  <span class=c1># extend conversation with assistant&#39;s reply</span>
</span></span><span class=line><span class=cl>        <span class=c1># Step 4: send the info for each function call and function response to the model</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>tool_call</span> <span class=ow>in</span> <span class=n>tool_calls</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>function_name</span> <span class=o>=</span> <span class=n>tool_call</span><span class=o>.</span><span class=n>function</span><span class=o>.</span><span class=n>name</span>
</span></span><span class=line><span class=cl>            <span class=n>function_to_call</span> <span class=o>=</span> <span class=n>available_functions</span><span class=p>[</span><span class=n>function_name</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>function_args</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>tool_call</span><span class=o>.</span><span class=n>function</span><span class=o>.</span><span class=n>arguments</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>function_response</span> <span class=o>=</span> <span class=n>function_to_call</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>keyword</span><span class=o>=</span><span class=n>function_args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;keyword&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>messages</span><span class=o>.</span><span class=n>append</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;tool_call_id&#34;</span><span class=p>:</span> <span class=n>tool_call</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;role&#34;</span><span class=p>:</span> <span class=s2>&#34;tool&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;name&#34;</span><span class=p>:</span> <span class=n>function_name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;content&#34;</span><span class=p>:</span> <span class=n>function_response</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>  <span class=c1># extend conversation with function response</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;------Call Tool Messages------&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>pprint</span><span class=o>.</span><span class=n>pprint</span><span class=p>(</span><span class=n>messages</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>second_response</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=n>chat</span><span class=o>.</span><span class=n>completions</span><span class=o>.</span><span class=n>create</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>model</span><span class=o>=</span><span class=n>MODEL_DEPLOYMENT_NAME</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>messages</span><span class=o>=</span><span class=n>messages</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>  <span class=c1># get a new response from the model where it can see the function response</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>second_response</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>MODEL_DEPLOYMENT_NAME</span> <span class=o>=</span> <span class=s2>&#34;gpt-4&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>anime</span> <span class=o>=</span> <span class=s2>&#34;EVA&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>resp</span> <span class=o>=</span> <span class=n>run_conversation</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;Search for the anime and summarize its story, tags, ratings, etc. Use English.: </span><span class=si>{</span><span class=n>anime</span><span class=si>=}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;------Second Response------&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>pprint</span><span class=o>.</span><span class=n>pprint</span><span class=p>(</span><span class=n>resp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;------Content------&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>resp</span><span class=o>.</span><span class=n>choices</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>message</span><span class=o>.</span><span class=n>content</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=internal-message-structure>Internal Message Structure<a hidden class=anchor aria-hidden=true href=#internal-message-structure>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>------</span><span class=n>First</span> <span class=n>Response</span><span class=o>------</span>
</span></span><span class=line><span class=cl><span class=n>ChatCompletionMessage</span><span class=p>(</span><span class=n>content</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>role</span><span class=o>=</span><span class=s1>&#39;assistant&#39;</span><span class=p>,</span> <span class=n>function_call</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>tool_calls</span><span class=o>=</span><span class=p>[</span><span class=n>ChatCompletionMessageToolCall</span><span class=p>(</span><span class=nb>id</span><span class=o>=</span><span class=s1>&#39;call_E1s6hI3fsPNyaJH0pJfFnYmD&#39;</span><span class=p>,</span> <span class=n>function</span><span class=o>=</span><span class=n>Function</span><span class=p>(</span><span class=n>arguments</span><span class=o>=</span><span class=s1>&#39;{&#34;keyword&#34;: &#34;EVA&#34;}&#39;</span><span class=p>,</span> <span class=n>name</span><span class=o>=</span><span class=s1>&#39;search_anime&#39;</span><span class=p>),</span> <span class=nb>type</span><span class=o>=</span><span class=s1>&#39;function&#39;</span><span class=p>)])</span>
</span></span><span class=line><span class=cl><span class=o>------</span><span class=n>Call</span> <span class=n>Tool</span> <span class=n>Messages</span><span class=o>------</span>
</span></span><span class=line><span class=cl><span class=p>[{</span><span class=s1>&#39;content&#39;</span><span class=p>:</span> <span class=s1>&#39;Search for the anime and summarize its story, tags, ratings, &#39;</span>
</span></span><span class=line><span class=cl>             <span class=s2>&#34;etc. Use English.: anime=&#39;EVA&#39;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;role&#39;</span><span class=p>:</span> <span class=s1>&#39;user&#39;</span><span class=p>},</span>
</span></span><span class=line><span class=cl> <span class=n>ChatCompletionMessage</span><span class=p>(</span><span class=n>content</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>role</span><span class=o>=</span><span class=s1>&#39;assistant&#39;</span><span class=p>,</span> <span class=n>function_call</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>tool_calls</span><span class=o>=</span><span class=p>[</span><span class=n>ChatCompletionMessageToolCall</span><span class=p>(</span><span class=nb>id</span><span class=o>=</span><span class=s1>&#39;call_E1s6hI3fsPNyaJH0pJfFnYmD&#39;</span><span class=p>,</span> <span class=n>function</span><span class=o>=</span><span class=n>Function</span><span class=p>(</span><span class=n>arguments</span><span class=o>=</span><span class=s1>&#39;{&#34;keyword&#34;: &#34;EVA&#34;}&#39;</span><span class=p>,</span> <span class=n>name</span><span class=o>=</span><span class=s1>&#39;search_anime&#39;</span><span class=p>),</span> <span class=nb>type</span><span class=o>=</span><span class=s1>&#39;function&#39;</span><span class=p>)]),</span>
</span></span><span class=line><span class=cl> <span class=p>{</span><span class=s1>&#39;content&#39;</span><span class=p>:</span> <span class=s1>&#39;{&#34;data&#34;:[{&#34;date&#34;:&#34;1995-10-04&#34;,&#34;image&#34;:&#34;https://lain.bgm.tv/pic/cover/l/e5/69/265_Z5Uou.jpg&#34;,&#34;type&#34;:2,&#34;summary&#34;:&#34;</span><span class=se>\u3000\u3000</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl>             <span class=s1>&#39;2000年，一个科学探险队在南极洲针对被称作“第一使徒”亚当的“光之巨人”进行探险。在对其进行接触实验时，“光之巨人”自毁，从而发生了“第二次冲击”，进而导致 世界大战。最后，人类人口减半，地轴偏转、气候改变。根据对“第二次冲击”的调查，联合国在日本箱根成立人工进化研究所（即 &#39;</span>
</span></span><span class=line><span class=cl>             <span class=s1>&#39;GEHIRN）从事EVA（指机器人）的发展研究，后GEHIRN利用在人工进化研究所下方发现的巨大空洞建造了总部。</span><span class=se>\\</span><span class=s1>r</span><span class=se>\\</span><span class=s1>n</span><span class=se>\u3000\u3000</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl>             <span class=s1>&#39;另一方面，联合国下属秘密组织SEELE为了使人类进化，开始实行人类补完计划，就是将所有人的灵魂汇集在一起，通过中和每个人的AT力场，使每个人回归LCL之海。</span><span class=se>\\</span><span class=s1>r</span><span class=se>\\</span><span class=s1>n</span><span class=se>\u3000\u3000</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl>             <span class=s1>&#39;2004年，EVA初号机进行启动试验时发生事故，碇真嗣的母亲碇唯消失，碇源渡开始执行“碇源渡版本的人类补完计划”。2010年，GEHIRN被改建成NERV。</span><span class=se>\\</span><span class=s1>r</span><span class=se>\\</span><span class=s1>n</span><span class=se>\u3000\u3000</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl>             <span class=s2>&#34;2015年开始，根据SEELE人类补完计划剧本的安排，一种巨型人形生物“使徒”开始在日本登陆，并向NERV总部进攻，NERV组织EVA消灭使徒。在NERV与使徒作战的同时， 碇源渡秘密地执行它自己的计划。随着时间推移，碇源渡的计划逐渐被SEELE发现，NERV与SEELE产生了矛盾并不断恶化。</span><span class=se>\\</span><span class=s2>r</span><span class=se>\\</span><span class=s2>nDirector&#39;s &#34;</span>
</span></span><span class=line><span class=cl>             <span class=s1>&#39;Cut版本的第21～24集由剧场版《Death》篇剪辑而成，收录在20周年纪念版的蓝光中。&#34;,&#34;name&#34;:&#34;新世紀エヴァンゲリオン&#34;,&#34;name_cn&#34;:&#34;新世纪福音战士&#34;,&#34;tags&#34;:[{&#34;</span>
</span></span><span class=line><span class=cl><span class=n>name</span><span class=s2>&#34;:&#34;</span><span class=n>EVA</span><span class=s2>&#34;,&#34;</span><span class=n>count</span><span class=s2>&#34;:7833},{&#34;</span><span class=n>name</span><span class=s2>&#34;:&#34;</span><span class=n>庵野秀明</span><span class=s2>&#34;,&#34;</span><span class=n>count</span><span class=s2>&#34;:5809},{&#34;</span><span class=n>name</span><span class=s2>&#34;:&#34;</span><span class=n>GAINAX</span><span class=s2>&#34;,&#34;</span><span class=n>count</span><span class=s2>&#34;:3751},{&#34;</span><span class=n>name</span><span class=s2>&#34;:&#34;</span><span class=n>新世纪福音战士</span><span class=s2>&#34;,&#34;</span><span class=n>count</span><span class=s2>&#34;:3377},{&#34;</span><span class=n>name</span><span class=s2>&#34;:&#34;</span><span class=n>神作</span><span class=s2>&#34;,&#34;</span><span class=n>count</span><span class=s2>&#34;:2847},{&#34;</span><span class=n>n</span>
</span></span><span class=line><span class=cl><span class=n>ame</span><span class=s2>&#34;:&#34;</span><span class=n>科幻</span><span class=s2>&#34;,&#34;</span><span class=n>count</span><span class=s2>&#34;:2635},{&#34;</span><span class=n>name</span><span class=s2>&#34;:&#34;</span><span class=n>宗教</span><span class=s2>&#34;,&#34;</span><span class=n>count</span><span class=s2>&#34;:1832},{&#34;</span><span class=n>name</span><span class=s2>&#34;:&#34;</span><span class=n>TV</span><span class=s2>&#34;,&#34;</span><span class=n>count</span><span class=s2>&#34;:1778},{&#34;</span><span class=n>name</span><span class=s2>&#34;:&#34;</span><span class=n>心理</span><span class=s2>&#34;,&#34;</span><span class=n>count</span><span class=s2>&#34;:1414},{&#34;</span><span class=n>name</span><span class=s2>&#34;:&#34;</span><span class=mi>1995</span><span class=s2>&#34;,&#34;</span><span class=n>count</span><span class=s2>&#34;:1157},{&#34;</span><span class=n>name</span><span class=s2>&#34;:&#34;</span><span class=n>骗钱神棍片的</span>
</span></span><span class=line><span class=cl><span class=n>者</span><span class=s2>&#34;,&#34;</span><span class=n>count</span><span class=s2>&#34;:1044},{&#34;</span><span class=n>name</span><span class=s2>&#34;:&#34;</span><span class=n>原创</span><span class=s2>&#34;,&#34;</span><span class=n>count</span><span class=s2>&#34;:936},{&#34;</span><span class=n>name</span><span class=s2>&#34;:&#34;</span><span class=n>补完</span><span class=s2>&#34;,&#34;</span><span class=n>count</span><span class=s2>&#34;:798},{&#34;</span><span class=n>name</span><span class=s2>&#34;:&#34;</span><span class=n>凌波</span><span class=s2>&#34;,&#34;</span><span class=n>count</span><span class=s2>&#34;:703},{&#34;</span><span class=n>name</span><span class=s2>&#34;:&#34;</span><span class=n>Evangelion</span><span class=s2>&#34;,&#34;</span><span class=n>count</span><span class=s2>&#34;:620},{&#34;</span><span class=n>name</span><span class=s2>&#34;:&#34;</span><span class=n>圣经</span><span class=s2>&#34;,&#34;</span><span class=n>count</span><span class=s2>&#34;: :</span>
</span></span><span class=line><span class=cl><span class=mi>353</span><span class=p>},{</span><span class=s2>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;神棍&#34;</span><span class=p>,</span><span class=s2>&#34;count&#34;</span><span class=p>:</span><span class=mi>237</span><span class=p>},{</span><span class=s2>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;1995年10月&#34;</span><span class=p>,</span><span class=s2>&#34;count&#34;</span><span class=p>:</span><span class=mi>206</span><span class=p>},{</span><span class=s2>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;机战&#34;</span><span class=p>,</span><span class=s2>&#34;count&#34;</span><span class=p>:</span><span class=mi>181</span><span class=p>},{</span><span class=s2>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;萝卜&#34;</span><span class=p>,</span><span class=s2>&#34;count&#34;</span><span class=p>:</span><span class=mi>180</span><span class=p>},{</span><span class=s2>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;战斗&#34;</span><span class=p>,</span><span class=s2>&#34;count&#34;</span><span class=p>:</span><span class=mi>141</span><span class=p>},{</span><span class=s2>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34; </span>
</span></span><span class=line><span class=cl><span class=n>经典</span><span class=s2>&#34;,&#34;</span><span class=n>count</span><span class=s2>&#34;:111},{&#34;</span><span class=n>name</span><span class=s2>&#34;:&#34;</span><span class=n>意识流</span><span class=s2>&#34;,&#34;</span><span class=n>count</span><span class=s2>&#34;:106},{&#34;</span><span class=n>name</span><span class=s2>&#34;:&#34;</span><span class=n>贞本义行</span><span class=s2>&#34;,&#34;</span><span class=n>count</span><span class=s2>&#34;:77},{&#34;</span><span class=n>name</span><span class=s2>&#34;:&#34;</span><span class=n>明日香</span><span class=s2>&#34;,&#34;</span><span class=n>count</span><span class=s2>&#34;:62},{&#34;</span><span class=n>name</span><span class=s2>&#34;:&#34;</span><span class=mi>1995</span><span class=n>年</span><span class=s2>&#34;,&#34;</span><span class=n>count</span><span class=s2>&#34;:53},{&#34;</span><span class=n>name</span><span class=s2>&#34;:&#34;</span><span class=n>生命中的哀伤与</span>
</span></span><span class=line><span class=cl><span class=n>忆</span><span class=s2>&#34;,&#34;</span><span class=n>count</span><span class=s2>&#34;:53},{&#34;</span><span class=n>name</span><span class=s2>&#34;:&#34;</span><span class=n>龙之子Production</span><span class=s2>&#34;,&#34;</span><span class=n>count</span><span class=s2>&#34;:50},{&#34;</span><span class=n>name</span><span class=s2>&#34;:&#34;</span><span class=n>童年</span><span class=s2>&#34;,&#34;</span><span class=n>count</span><span class=s2>&#34;:47},{&#34;</span><span class=n>name</span><span class=s2>&#34;:&#34;</span><span class=n>日本</span><span class=s2>&#34;,&#34;</span><span class=n>count</span><span class=s2>&#34;:43}],&#34;</span><span class=n>score</span><span class=s2>&#34;:8.8,&#34;</span><span class=nb>id</span><span class=s2>&#34;:265,&#34;</span><span class=n>rank</span><span class=s2>&#34;:9},{&#34;</span><span class=n>date</span><span class=s2>&#34;:&#34;&#34;,&#34;</span><span class=n>image</span><span class=s2>&#34; &#34;</span><span class=p>:</span><span class=s2>&#34;&#34;</span><span class=p>,</span><span class=s2>&#34;type&#34;</span><span class=p>:</span><span class=mi>2</span><span class=p>,</span><span class=s2>&#34;summary&#34;</span><span class=p>:</span><span class=s2>&#34;半年前，早在为《EVA新剧场版》造势的时候，Bandai &#39;</span>
</span></span><span class=line><span class=cl>             <span class=s1>&#39;就公布了以Q版COLLECTION FIGURE开端，讲述发生在NERV学院中的一段段恩怨情仇的《DEFORMER &#39;</span>
</span></span><span class=line><span class=cl>             <span class=s1>&#39;EVA（デフォルメエヴァ）》FIGURE企划第一弹，EVA2007春季攻势-校园剧《ぷちえヴぁ EVANGELION @ &#39;</span>
</span></span><span class=line><span class=cl>             <span class=s1>&#39;SCHOOL》，并拍成了动画短篇。绫波三姐妹，红龙明日香，万年受真嗣，以及越熟越可爱的葛成美里姐姐，不，老师，还有身处黑暗中的学校不良少年王 &#39;</span>
</span></span><span class=line><span class=cl>             <span class=s1>&#39;“EVA长”（友情客串：初号机）。整套玩偶共分9套，包括8套公开版本和一个SECRET版本。&#34;,&#34;name&#34;:&#34;EVA爆笑校园&#34;,&#34;name_cn&#34;:&#34;&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;EVA&#34;,&#34;count&#34;:5}</span>
</span></span><span class=line><span class=cl><span class=p>,{</span><span class=s2>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;额&#34;</span><span class=p>,</span><span class=s2>&#34;count&#34;</span><span class=p>:</span><span class=mi>2</span><span class=p>},{</span><span class=s2>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;Q版劇&#34;</span><span class=p>,</span><span class=s2>&#34;count&#34;</span><span class=p>:</span><span class=mi>1</span><span class=p>}],</span><span class=s2>&#34;score&#34;</span><span class=p>:</span><span class=mf>7.3</span><span class=p>,</span><span class=s2>&#34;id&#34;</span><span class=p>:</span><span class=mi>3387</span><span class=p>,</span><span class=s2>&#34;rank&#34;</span><span class=p>:</span><span class=mi>0</span><span class=p>},{</span><span class=s2>&#34;date&#34;</span><span class=p>:</span><span class=s2>&#34;2012-11-17&#34;</span><span class=p>,</span><span class=s2>&#34;image&#34;</span><span class=p>:</span><span class=s2>&#34;https://lain.bgm.tv/pic/cover/l/69/63/61290_9O</span>
</span></span><span class=line><span class=cl><span class=n>TjL</span><span class=o>.</span><span class=n>jpg</span><span class=s2>&#34;,&#34;</span><span class=nb>type</span><span class=s2>&#34;:2,&#34;</span><span class=n>summary</span><span class=s2>&#34;:&#34;</span><span class=n>近第3次冲击</span><span class=err>”</span><span class=n>过后的第14年</span><span class=err>，</span><span class=n>世界依然血红</span><span class=err>。</span><span class=n>无数类似EVA01的生命徘徊在补完未完成的世界</span><span class=err>。</span><span class=n>NERV分裂</span><span class=err>，</span><span class=n>Wille的出现</span><span class=err>，</span><span class=n>碇源堂和Seele的计划</span><span class=err>，</span><span class=n>如约</span> 
</span></span><span class=line><span class=cl><span class=n>在行</span><span class=err>。《</span><span class=n>死海文书</span><span class=err>》</span><span class=n>的预言也到了尽头</span><span class=err>，</span><span class=n>新轮回的开始注定源于毁灭</span><span class=err>。</span><span class=n>取出</span><span class=err>“</span><span class=n>卡西乌斯枪</span><span class=err>”</span><span class=n>和</span><span class=err>“</span><span class=n>朗基努斯枪</span><span class=err>”，</span><span class=n>解除14年来的处于</span><span class=err>“</span><span class=n>莉莉丝</span><span class=err>”</span><span class=n>周围的结界和封印</span><span class=err>，</span><span class=n>成为命运的牵绊</span><span class=err>：</span><span class=n>渚熏和碇</span> <span class=n>真嗣</span><span class=err>，</span><span class=n>终将驾驶EVA13与生死离别</span><span class=err>……</span><span class=s2>&#34;,&#34;</span><span class=n>name</span><span class=s2>&#34;:&#34;</span><span class=n>EVA</span> <span class=s1>&#39;</span>
</span></span><span class=line><span class=cl>             <span class=s1>&#39;:Q&#34;,&#34;name_cn&#34;:&#34;新世纪福音战士剧场版：Q&#34;,&#34;tags&#34;:[],&#34;score&#34;:7,&#34;id&#34;:61290,&#34;rank&#34;:0}],&#34;total&#34;:17,&#34;limit&#34;:3,&#34;offset&#34;:0}</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;name&#39;</span><span class=p>:</span> <span class=s1>&#39;search_anime&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;role&#39;</span><span class=p>:</span> <span class=s1>&#39;tool&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;tool_call_id&#39;</span><span class=p>:</span> <span class=s1>&#39;call_E1s6hI3fsPNyaJH0pJfFnYmD&#39;</span><span class=p>}]</span>
</span></span><span class=line><span class=cl><span class=o>------</span><span class=n>Second</span> <span class=n>Response</span><span class=o>------</span>
</span></span><span class=line><span class=cl><span class=n>ChatCompletion</span><span class=p>(</span><span class=nb>id</span><span class=o>=</span><span class=s1>&#39;chatcmpl-9LS1xyK6B9Q47bSZKzBjFftIsZk27&#39;</span><span class=p>,</span> <span class=n>choices</span><span class=o>=</span><span class=p>[</span><span class=n>Choice</span><span class=p>(</span><span class=n>finish_reason</span><span class=o>=</span><span class=s1>&#39;stop&#39;</span><span class=p>,</span> <span class=n>index</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=n>logprobs</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>message</span><span class=o>=</span><span class=n>ChatCompletionMessage</span><span class=p>(</span><span class=n>content</span><span class=o>=</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl><span class=c1>### 1. Neon Genesis Evangelion (新世紀エヴァンゲリオン)\n\n- **Original Name:** 新世紀エヴァンゲリオン\n- **English Name:** Neon Genesis Evangelion\n- **Date Rel</span>
</span></span><span class=line><span class=cl><span class=n>eased</span><span class=p>:</span><span class=o>**</span> <span class=mi>1995</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>04</span>\<span class=n>n</span><span class=o>-</span> <span class=o>**</span><span class=n>Type</span><span class=p>:</span><span class=o>**</span> <span class=n>TV</span> <span class=n>Series</span>\<span class=n>n</span><span class=o>-</span> <span class=o>**</span><span class=n>Summary</span><span class=p>:</span><span class=o>**</span> <span class=n>In</span> <span class=n>the</span> <span class=n>year</span> <span class=mi>2000</span><span class=p>,</span> <span class=n>a</span> <span class=n>scientific</span> <span class=n>expedition</span> <span class=ow>in</span> <span class=n>Antarctica</span> <span class=n>exploring</span> <span class=n>the</span> <span class=s2>&#34;Giant of Light&#34;</span> <span class=n>known</span> <span class=k>as</span> <span class=s2>&#34;Adam&#34;</span>
</span></span><span class=line><span class=cl> <span class=n>triggers</span> <span class=n>the</span> <span class=s2>&#34;Second Impact,&#34;</span> <span class=n>leading</span> <span class=n>to</span> <span class=n>a</span> <span class=n>devastating</span> <span class=n>world</span> <span class=n>war</span><span class=p>,</span> <span class=n>climate</span> <span class=n>change</span><span class=p>,</span> <span class=ow>and</span> <span class=n>a</span> <span class=n>halved</span> <span class=n>human</span> <span class=n>population</span><span class=o>.</span> <span class=n>GEHIRN</span><span class=p>,</span> <span class=n>which</span> <span class=n>later</span> <span class=n>becomes</span> <span class=n>NERV</span><span class=p>,</span> <span class=ow>is</span> <span class=n>establishe</span>
</span></span><span class=line><span class=cl><span class=n>d</span> <span class=n>to</span> <span class=n>develop</span> <span class=n>Evangelions</span> <span class=p>(</span><span class=n>EVA</span><span class=p>)</span> <span class=n>to</span> <span class=n>combat</span> <span class=n>giant</span> <span class=n>beings</span> <span class=n>known</span> <span class=k>as</span> <span class=s2>&#34;Angels.&#34;</span> <span class=n>The</span> <span class=n>series</span> <span class=n>follows</span> <span class=n>the</span> <span class=n>battles</span> <span class=n>of</span> <span class=n>the</span> <span class=n>EVAs</span> <span class=n>against</span> <span class=n>the</span> <span class=n>Angels</span><span class=p>,</span> <span class=n>interwoven</span> <span class=k>with</span> <span class=nb>complex</span> <span class=n>t</span>
</span></span><span class=line><span class=cl><span class=n>hemes</span> <span class=n>of</span> <span class=n>religion</span><span class=p>,</span> <span class=n>psychology</span><span class=p>,</span> <span class=ow>and</span> <span class=n>human</span> <span class=n>relationships</span><span class=o>.</span>\<span class=n>n</span><span class=o>-</span> <span class=o>**</span><span class=n>Tags</span><span class=p>:</span><span class=o>**</span> <span class=n>EVA</span><span class=p>,</span> <span class=n>Hideaki</span> <span class=n>Anno</span><span class=p>,</span> <span class=n>GAINAX</span><span class=p>,</span> <span class=n>science</span> <span class=n>fiction</span><span class=p>,</span> <span class=n>religion</span><span class=p>,</span> <span class=n>psychology</span><span class=p>,</span> <span class=n>original</span><span class=p>,</span> <span class=n>combat</span><span class=p>,</span> <span class=n>classic</span><span class=p>,</span>
</span></span><span class=line><span class=cl> <span class=n>existential</span>\<span class=n>n</span><span class=o>-</span> <span class=o>**</span><span class=n>Score</span><span class=p>:</span><span class=o>**</span> <span class=mf>8.8</span>\<span class=n>n</span><span class=o>-</span> <span class=o>**</span><span class=n>Rank</span><span class=p>:</span><span class=o>**</span> <span class=mi>9</span>\<span class=n>n</span><span class=o>-</span> <span class=p>[</span><span class=n>Link</span> <span class=n>to</span> <span class=n>more</span> <span class=n>information</span><span class=p>](</span><span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>lain</span><span class=o>.</span><span class=n>bgm</span><span class=o>.</span><span class=n>tv</span><span class=o>/</span><span class=n>pic</span><span class=o>/</span><span class=n>cover</span><span class=o>/</span><span class=n>l</span><span class=o>/</span><span class=n>e5</span><span class=o>/</span><span class=mi>69</span><span class=o>/</span><span class=mi>265</span><span class=n>_Z5Uou</span><span class=o>.</span><span class=n>jpg</span><span class=p>)</span>\<span class=n>n</span>\<span class=n>n</span><span class=c1>### 2. EVA Laughing Schoolyar</span>
</span></span><span class=line><span class=cl><span class=n>d</span> <span class=p>(</span><span class=n>EVA爆笑校园</span><span class=p>)</span>\<span class=n>n</span>\<span class=n>n</span><span class=o>-</span> <span class=o>**</span><span class=n>Original</span> <span class=n>Name</span><span class=p>:</span><span class=o>**</span> <span class=n>EVA爆笑校园</span>\<span class=n>n</span><span class=o>-</span> <span class=o>**</span><span class=n>Date</span> <span class=n>Released</span><span class=p>:</span><span class=o>**</span> <span class=n>Unspecified</span>\<span class=n>n</span><span class=o>-</span> <span class=o>**</span><span class=n>Type</span><span class=p>:</span><span class=o>**</span> <span class=n>Project</span>\<span class=n>n</span><span class=o>-</span> <span class=o>**</span><span class=n>Summary</span><span class=p>:</span><span class=o>**</span> <span class=n>An</span> <span class=n>initiative</span> <span class=n>by</span> <span class=n>Bandai</span> <span class=n>ahead</span> <span class=n>of</span> <span class=s2>&#34;EVA </span>
</span></span><span class=line><span class=cl><span class=n>New</span> <span class=n>Theatre</span> <span class=n>Edition</span><span class=p>,</span><span class=s2>&#34; starting with Q-version COLLECTION FIGURE, it narrates the relationships and rivalries within the NERV Academy through animated shorts. It </span>
</span></span><span class=line><span class=cl><span class=n>features</span> <span class=n>a</span> <span class=n>playful</span> <span class=ow>and</span> <span class=n>cute</span> <span class=n>take</span> <span class=n>on</span> <span class=n>the</span> <span class=n>characters</span> <span class=kn>from</span> <span class=nn>the</span> <span class=n>original</span> <span class=n>Evangelion</span> <span class=n>series</span><span class=o>.</span>\<span class=n>n</span><span class=o>-</span> <span class=o>**</span><span class=n>Tags</span><span class=p>:</span><span class=o>**</span> <span class=n>EVA</span><span class=p>,</span> <span class=n>Q</span><span class=o>-</span><span class=n>version</span> <span class=n>drama</span>\<span class=n>n</span><span class=o>-</span> <span class=o>**</span><span class=n>Score</span><span class=p>:</span><span class=o>**</span> <span class=mf>7.3</span>\<span class=n>n</span>\<span class=n>n</span><span class=c1>### 3. EVA :Q (新 </span>
</span></span><span class=line><span class=cl><span class=n>世纪福音战士剧场版</span><span class=err>：</span><span class=n>Q</span><span class=p>)</span>\<span class=n>n</span>\<span class=n>n</span><span class=o>-</span> <span class=o>**</span><span class=n>Original</span> <span class=n>Name</span><span class=p>:</span><span class=o>**</span> <span class=n>EVA</span> <span class=p>:</span><span class=n>Q</span>\<span class=n>n</span><span class=o>-</span> <span class=o>**</span><span class=n>English</span> <span class=n>Name</span><span class=p>:</span><span class=o>**</span> <span class=n>Neon</span> <span class=n>Genesis</span> <span class=n>Evangelion</span><span class=p>:</span> <span class=n>Q</span>\<span class=n>n</span><span class=o>-</span> <span class=o>**</span><span class=n>Date</span> <span class=n>Released</span><span class=p>:</span><span class=o>**</span> <span class=mi>2012</span><span class=o>-</span><span class=mi>11</span><span class=o>-</span><span class=mi>17</span>\<span class=n>n</span><span class=o>-</span> <span class=o>**</span><span class=n>Type</span><span class=p>:</span><span class=o>**</span> <span class=n>Film</span>\<span class=n>n</span><span class=o>-</span> <span class=o>**</span><span class=n>Sum</span>
</span></span><span class=line><span class=cl><span class=n>mary</span><span class=p>:</span><span class=o>**</span> <span class=n>Set</span> <span class=mi>14</span> <span class=n>years</span> <span class=n>after</span> <span class=n>the</span> <span class=s2>&#34;nearly 3rd Impact,&#34;</span> <span class=n>the</span> <span class=n>world</span> <span class=ow>is</span> <span class=n>still</span> <span class=n>reeling</span> <span class=kn>from</span> <span class=nn>its</span> <span class=n>incomplete</span> <span class=n>state</span><span class=o>.</span> <span class=n>With</span> <span class=n>the</span> <span class=n>splintering</span> <span class=n>of</span> <span class=n>NERV</span> <span class=ow>and</span> <span class=n>the</span> <span class=n>emergence</span> <span class=n>of</span> <span class=n>Wille</span>
</span></span><span class=line><span class=cl><span class=p>,</span> <span class=n>the</span> <span class=n>stage</span> <span class=ow>is</span> <span class=nb>set</span> <span class=k>for</span> <span class=n>the</span> <span class=n>fulfillment</span> <span class=n>of</span> <span class=n>Gendo</span> <span class=n>Ikari</span> <span class=ow>and</span> <span class=n>Seele</span>\<span class=s1>&#39;s plans, alongside the prophecies of the Dead Sea Scrolls. Shinji and Kaworu navigate a world on</span>
</span></span><span class=line><span class=cl> <span class=n>the</span> <span class=n>brink</span> <span class=n>of</span> <span class=n>a</span> <span class=n>new</span> <span class=n>cycle</span><span class=p>,</span> <span class=n>ultimately</span> <span class=n>piloting</span> <span class=n>EVA</span> <span class=n>Unit</span><span class=o>-</span><span class=mi>13</span> <span class=n>towards</span> <span class=n>a</span> <span class=n>fateful</span> <span class=n>confrontation</span><span class=o>.</span>\<span class=n>n</span><span class=o>-</span> <span class=o>**</span><span class=n>Score</span><span class=p>:</span><span class=o>**</span> <span class=mf>7.0</span>\<span class=n>n</span>\<span class=n>nPlease</span> <span class=n>note</span> <span class=n>that</span> <span class=n>the</span> <span class=n>details</span> <span class=n>provided</span><span class=p>,</span> <span class=n>especiall</span>
</span></span><span class=line><span class=cl><span class=n>y</span> <span class=k>for</span> <span class=n>the</span> <span class=n>second</span> <span class=n>entry</span> <span class=s2>&#34;EVA Laughing Schoolyard,&#34;</span> <span class=n>are</span> <span class=n>rather</span> <span class=n>limited</span><span class=p>,</span> <span class=ow>and</span> <span class=n>the</span> <span class=n>focus</span> <span class=n>primarily</span> <span class=n>lies</span> <span class=n>on</span> <span class=n>toy</span> <span class=n>figures</span> <span class=ow>and</span> <span class=n>a</span> <span class=n>lighter</span><span class=p>,</span> <span class=n>humorous</span> <span class=n>take</span> <span class=n>on</span> <span class=n>the</span> <span class=n>original</span> <span class=n>Ev</span>
</span></span><span class=line><span class=cl><span class=n>angelion</span> <span class=n>universe</span><span class=o>.</span><span class=s1>&#39;, role=&#39;</span><span class=n>assistant</span><span class=s1>&#39;, function_call=None, tool_calls=None), content_filter_results={&#39;</span><span class=n>hate</span><span class=s1>&#39;: {&#39;</span><span class=n>filtered</span><span class=s1>&#39;: False, &#39;</span><span class=n>severity</span><span class=s1>&#39;: &#39;</span><span class=n>safe</span><span class=s1>&#39;}, &#39;</span><span class=n>self_harm</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl><span class=p>:</span> <span class=p>{</span><span class=s1>&#39;filtered&#39;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span> <span class=s1>&#39;severity&#39;</span><span class=p>:</span> <span class=s1>&#39;safe&#39;</span><span class=p>},</span> <span class=s1>&#39;sexual&#39;</span><span class=p>:</span> <span class=p>{</span><span class=s1>&#39;filtered&#39;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span> <span class=s1>&#39;severity&#39;</span><span class=p>:</span> <span class=s1>&#39;safe&#39;</span><span class=p>},</span> <span class=s1>&#39;violence&#39;</span><span class=p>:</span> <span class=p>{</span><span class=s1>&#39;filtered&#39;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span> <span class=s1>&#39;severity&#39;</span><span class=p>:</span> <span class=s1>&#39;safe&#39;</span><span class=p>}})],</span> <span class=n>created</span><span class=o>=</span><span class=mi>171</span>
</span></span><span class=line><span class=cl><span class=mi>4899665</span><span class=p>,</span> <span class=n>model</span><span class=o>=</span><span class=s1>&#39;gpt-4&#39;</span><span class=p>,</span> <span class=nb>object</span><span class=o>=</span><span class=s1>&#39;chat.completion&#39;</span><span class=p>,</span> <span class=n>system_fingerprint</span><span class=o>=</span><span class=s1>&#39;fp_2f57f81c11&#39;</span><span class=p>,</span> <span class=n>usage</span><span class=o>=</span><span class=n>CompletionUsage</span><span class=p>(</span><span class=n>completion_tokens</span><span class=o>=</span><span class=mi>621</span><span class=p>,</span> <span class=n>prompt_tokens</span><span class=o>=</span><span class=mi>1736</span><span class=p>,</span> <span class=n>total_toke</span>
</span></span><span class=line><span class=cl><span class=n>ns</span><span class=o>=</span><span class=mi>2357</span><span class=p>),</span> <span class=n>prompt_filter_results</span><span class=o>=</span><span class=p>[{</span><span class=s1>&#39;prompt_index&#39;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span> <span class=s1>&#39;content_filter_results&#39;</span><span class=p>:</span> <span class=p>{</span><span class=s1>&#39;hate&#39;</span><span class=p>:</span> <span class=p>{</span><span class=s1>&#39;filtered&#39;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span> <span class=s1>&#39;severity&#39;</span><span class=p>:</span> <span class=s1>&#39;safe&#39;</span><span class=p>},</span> <span class=s1>&#39;self_harm&#39;</span><span class=p>:</span> <span class=p>{</span><span class=s1>&#39;filtered&#39;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span> <span class=s1>&#39;severity&#39;</span><span class=p>:</span> <span class=s1>&#39;safe&#39;</span><span class=p>},</span> <span class=s1>&#39;sexual&#39;</span><span class=p>:</span> <span class=p>{</span><span class=s1>&#39;filtered&#39;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span> <span class=s1>&#39;severity&#39;</span><span class=p>:</span> <span class=s1>&#39;safe&#39;</span><span class=p>},</span> <span class=s1>&#39;violence&#39;</span><span class=p>:</span> <span class=p>{</span><span class=s1>&#39;filtered&#39;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span> <span class=s1>&#39;severity&#39;</span><span class=p>:</span> <span class=s1>&#39;safe&#39;</span><span class=p>}}}])</span>
</span></span></code></pre></div><h3 id=example-output>Example Output<a hidden class=anchor aria-hidden=true href=#example-output>#</a></h3><h4 id=1-neon-genesis-evangelion-新世紀エヴァンゲリオン>1. Neon Genesis Evangelion (新世紀エヴァンゲリオン)<a hidden class=anchor aria-hidden=true href=#1-neon-genesis-evangelion-新世紀エヴァンゲリオン>#</a></h4><ul><li><strong>Original Name:</strong> 新世紀エヴァンゲリオン</li><li><strong>English Name:</strong> Neon Genesis Evangelion</li><li><strong>Date Released:</strong> 1995-10-04</li><li><strong>Type:</strong> TV Series</li><li><strong>Summary:</strong> In the year 2000, a scientific expedition in Antarctica exploring the &ldquo;Giant of Light&rdquo; known as &ldquo;Adam&rdquo; triggers the &ldquo;Second Impact,&rdquo; leading to a
devastating world war, climate change, and a halved human population. GEHIRN, which later becomes NERV, is established to develop Evangelions (EVA) to combat gia
nt beings known as &ldquo;Angels.&rdquo; The series follows the battles of the EVAs against the Angels, interwoven with complex themes of religion, psychology, and human relationships.</li><li><strong>Tags:</strong> EVA, Hideaki Anno, GAINAX, science fiction, religion, psychology, original, combat, classic, existential</li><li><strong>Score:</strong> 8.8</li><li><strong>Rank:</strong> 9</li><li><a href=https://lain.bgm.tv/pic/cover/l/e5/69/265_Z5Uou.jpg>Link to more information</a></li></ul><h4 id=2-eva-laughing-schoolyard-eva爆笑校园>2. EVA Laughing Schoolyard (EVA爆笑校园)<a hidden class=anchor aria-hidden=true href=#2-eva-laughing-schoolyard-eva爆笑校园>#</a></h4><ul><li><strong>Original Name:</strong> EVA爆笑校园</li><li><strong>Date Released:</strong> Unspecified</li><li><strong>Type:</strong> Project</li><li><strong>Summary:</strong> An initiative by Bandai ahead of &ldquo;EVA New Theatre Edition,&rdquo; starting with Q-version COLLECTION FIGURE, it narrates the relationships and rivalries within the NERV Academy through animated shorts. It features a playful and cute take on the characters from the original Evangelion series.</li><li><strong>Tags:</strong> EVA, Q-version drama</li><li><strong>Score:</strong> 7.3</li></ul><h4 id=3-eva-q-新世纪福音战士剧场版q>3. EVA :Q (新世纪福音战士剧场版：Q)<a hidden class=anchor aria-hidden=true href=#3-eva-q-新世纪福音战士剧场版q>#</a></h4><ul><li><strong>Original Name:</strong> EVA :Q</li><li><strong>English Name:</strong> Neon Genesis Evangelion: Q</li><li><strong>Date Released:</strong> 2012-11-17</li><li><strong>Type:</strong> Film</li><li><strong>Summary:</strong> Set 14 years after the &ldquo;nearly 3rd Impact,&rdquo; the world is still reeling from its incomplete state. With the splintering of NERV and the emergence o
f Wille, the stage is set for the fulfillment of Gendo Ikari and Seele&rsquo;s plans, alongside the prophecies of the Dead Sea Scrolls. Shinji and Kaworu navigate a world on the brink of a new cycle, ultimately piloting EVA Unit-13 towards a fateful confrontation.</li><li><strong>Score:</strong> 7.0</li></ul><p>Please note that the details provided, especially for the second entry &ldquo;EVA Laughing Schoolyard,&rdquo; are rather limited, and the focus primarily lies on toy figures and a lighter, humorous take on the original Evangelion universe.</p><h2 id=references>References<a hidden class=anchor aria-hidden=true href=#references>#</a></h2><p><a href=https://platform.openai.com/docs/guides/function-calling>https://platform.openai.com/docs/guides/function-calling</a><br><a href=https://cookbook.openai.com/examples/how_to_call_functions_with_chat_models>https://cookbook.openai.com/examples/how_to_call_functions_with_chat_models</a><br><a href=https://docs.anthropic.com/claude/docs/tool-use>https://docs.anthropic.com/claude/docs/tool-use</a><br><a href=https://www.promptingguide.ai/applications/function_calling>https://www.promptingguide.ai/applications/function_calling</a><br><a href="https://learn.microsoft.com/en-us/azure/ai-services/openai/how-to/function-calling?tabs=python">https://learn.microsoft.com/en-us/azure/ai-services/openai/how-to/function-calling?tabs=python</a></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://zhoukuncheng.github.io/tags/llm/>LLM</a></li><li><a href=https://zhoukuncheng.github.io/tags/function-calling/>Function Calling</a></li></ul></footer><script src=https://giscus.app/client.js data-repo=zhoukuncheng/zhoukuncheng.github.io data-repo-id="MDEwOlJlcG9zaXRvcnkyODIxMTA1OTU=" data-category=General data-category-id=DIC_kwDOENCqg84Cexta data-mapping=og:title data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=purple_dark data-lang=en crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2024 <a href=https://zhoukuncheng.github.io/>zhoukuncheng's Personal Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>