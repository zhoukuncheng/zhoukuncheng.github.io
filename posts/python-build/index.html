<!doctype html><html lang=en dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Insights on Compiling CPython | zhoukuncheng's Personal Blog</title><meta name=keywords content="Python,GCC,Linux"><meta name=description content="When Do You Need to Compile CPython Yourself?
Most operating systems provide compiled CPython versions. Generally, installing through a package manager is sufficient. However, in some cases, you need to compile CPython yourself to meet specific requirements:


The Python version provided by the OS is too old, and the Python official website or system package repositories do not provide pre-compiled new versions of Python.


Pre-compiled versions do not meet performance or extension requirements, for example, compiler optimizations are not enabled, or OpenSSL/SQLite versions do not meet requirements."><meta name=author content="zhoukuncheng"><link rel=canonical href=https://zhoukuncheng.github.io/posts/python-build/><link crossorigin=anonymous href=/assets/css/stylesheet.343cc480b9ffc8f04ccbe5e968ad674880cab773ec19905e93033065c1e7a804.css integrity="sha256-NDzEgLn/yPBMy+XpaK1nSIDKt3PsGZBekwMwZcHnqAQ=" rel="preload stylesheet" as=style><link rel=icon href=https://zhoukuncheng.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://zhoukuncheng.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://zhoukuncheng.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://zhoukuncheng.github.io/apple-touch-icon.png><link rel=mask-icon href=https://zhoukuncheng.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://zhoukuncheng.github.io/zh/posts/python-build/><link rel=alternate hreflang=en href=https://zhoukuncheng.github.io/posts/python-build/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-GH88YSLNJN"></script><script>var doNotTrack=!1,dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-GH88YSLNJN")}</script><meta property="og:url" content="https://zhoukuncheng.github.io/posts/python-build/"><meta property="og:site_name" content="zhoukuncheng's Personal Blog"><meta property="og:title" content="Insights on Compiling CPython"><meta property="og:description" content="When Do You Need to Compile CPython Yourself? Most operating systems provide compiled CPython versions. Generally, installing through a package manager is sufficient. However, in some cases, you need to compile CPython yourself to meet specific requirements:
The Python version provided by the OS is too old, and the Python official website or system package repositories do not provide pre-compiled new versions of Python.
Pre-compiled versions do not meet performance or extension requirements, for example, compiler optimizations are not enabled, or OpenSSL/SQLite versions do not meet requirements."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-07-24T01:11:34+08:00"><meta property="article:modified_time" content="2020-07-24T01:11:34+08:00"><meta property="article:tag" content="Python"><meta property="article:tag" content="GCC"><meta property="article:tag" content="Linux"><meta name=twitter:card content="summary"><meta name=twitter:title content="Insights on Compiling CPython"><meta name=twitter:description content="When Do You Need to Compile CPython Yourself?
Most operating systems provide compiled CPython versions. Generally, installing through a package manager is sufficient. However, in some cases, you need to compile CPython yourself to meet specific requirements:


The Python version provided by the OS is too old, and the Python official website or system package repositories do not provide pre-compiled new versions of Python.


Pre-compiled versions do not meet performance or extension requirements, for example, compiler optimizations are not enabled, or OpenSSL/SQLite versions do not meet requirements."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://zhoukuncheng.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Insights on Compiling CPython","item":"https://zhoukuncheng.github.io/posts/python-build/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Insights on Compiling CPython","name":"Insights on Compiling CPython","description":"When Do You Need to Compile CPython Yourself? Most operating systems provide compiled CPython versions. Generally, installing through a package manager is sufficient. However, in some cases, you need to compile CPython yourself to meet specific requirements:\nThe Python version provided by the OS is too old, and the Python official website or system package repositories do not provide pre-compiled new versions of Python.\nPre-compiled versions do not meet performance or extension requirements, for example, compiler optimizations are not enabled, or OpenSSL/SQLite versions do not meet requirements.\n","keywords":["Python","GCC","Linux"],"articleBody":"When Do You Need to Compile CPython Yourself? Most operating systems provide compiled CPython versions. Generally, installing through a package manager is sufficient. However, in some cases, you need to compile CPython yourself to meet specific requirements:\nThe Python version provided by the OS is too old, and the Python official website or system package repositories do not provide pre-compiled new versions of Python.\nPre-compiled versions do not meet performance or extension requirements, for example, compiler optimizations are not enabled, or OpenSSL/SQLite versions do not meet requirements.\nParticipating in CPython development or trying out new features, such as Alpha/Beta/RC versions of Python.\nPrecautions When Compiling CPython on Older Linux Distributions OpenSSL Because the OpenSSL version in the official CentOS 6 repository is too old and does not meet the requirements of Python 3.7 and later, running simple configure \u0026 make will result in an error. Solution:\nRefer to Python 3.7 on CentOS 6, compile OpenSSL in advance, modify the Modules/Setup file when compiling CPython, and specify the environment variable LDFLAGS=\"-Wl,-rpath=/usr/local/openssl11/lib\" and argument -with-openssl=/usr/local/openssl11.\nSQLite Software like Jupyter relies on SQLite. When compiling CPython, you should not only pay attention to the SQLite version but also enable --enable-loadable-sqlite-extensions. Refer to: How to use enable_load_extension from sqlite3?\nCompilation Parameters Affecting Performance –enable-optimizations According to this StackOverflow question: what does –enable-optimizations do while compiling python?\nenable-optimizations enables PGO (Profile Guided Optimization) and LTO (Link Time Optimization) compiler optimizations. PGO performs two compilations. After the first compilation, it runs benchmark tests, and guides the second optimization compilation based on the tests.\nThe advantage is that it produces a more efficient CPython binary.\nThe disadvantage is that it firstly requires a certain compiler version (older GCC versions may error out during PGO compilation), and secondly, the compilation time increases significantly due to the benchmarks and the second compilation. Therefore, consider adding the -j parameter when running make to utilize multi-cores and reduce compilation time.\n-march Specifying the CPU architecture may also affect the performance of the compiled CPython. Extended reading: Compile-time Optimisations on Python 3\n-fno-semantic-interposition Refer to Red Hat Enterprise Linux 8.2 brings faster Python 3.8 run speeds.\nAdding the -fno-semantic-interposition option during GCC compilation disables Semantic interposition on Red Hat / Fedora distributions, bringing up to a 30% performance improvement.\nOf course, the above compilation parameters are related to specific distributions and compiler versions. You cannot simply assume they apply to all environments. The best way to evaluate performance is still to benchmark.\n","wordCount":"410","inLanguage":"en","datePublished":"2020-07-24T01:11:34+08:00","dateModified":"2020-07-24T01:11:34+08:00","author":{"@type":"Person","name":"zhoukuncheng"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://zhoukuncheng.github.io/posts/python-build/"},"publisher":{"@type":"Organization","name":"zhoukuncheng's Personal Blog","logo":{"@type":"ImageObject","url":"https://zhoukuncheng.github.io/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://zhoukuncheng.github.io/ accesskey=h title="zhoukuncheng's Personal Blog (Alt + H)">zhoukuncheng's Personal Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://zhoukuncheng.github.io/zh/ title=中文 aria-label=中文>Zh</a></li></ul></div></div><ul id=menu><li><a href=https://zhoukuncheng.github.io/ title=Home><span>Home</span></a></li><li><a href=https://zhoukuncheng.github.io/posts/ title=Archive><span>Archive</span></a></li><li><a href=https://zhoukuncheng.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://zhoukuncheng.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://zhoukuncheng.github.io/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Insights on Compiling CPython</h1><div class=post-meta><span title='2020-07-24 01:11:34 +0800 +0800'>July 24, 2020</span>&nbsp;·&nbsp;<span>zhoukuncheng</span>&nbsp;|&nbsp;<span>Translations:</span><ul class=i18n_list><li><a href=https://zhoukuncheng.github.io/zh/posts/python-build/>Zh</a></li></ul></div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#when-do-you-need-to-compile-cpython-yourself aria-label="When Do You Need to Compile CPython Yourself?">When Do You Need to Compile CPython Yourself?</a></li><li><a href=#precautions-when-compiling-cpython-on-older-linux-distributions aria-label="Precautions When Compiling CPython on Older Linux Distributions">Precautions When Compiling CPython on Older Linux Distributions</a><ul><li><a href=#openssl aria-label=OpenSSL>OpenSSL</a></li><li><a href=#sqlite aria-label=SQLite>SQLite</a></li></ul></li><li><a href=#compilation-parameters-affecting-performance aria-label="Compilation Parameters Affecting Performance">Compilation Parameters Affecting Performance</a><ul><li><a href=#enable-optimizations aria-label=&ndash;enable-optimizations>&ndash;enable-optimizations</a><ul><li><a href=#-march aria-label=-march>-march</a></li></ul></li><li><a href=#-fno-semantic-interposition aria-label=-fno-semantic-interposition>-fno-semantic-interposition</a></li></ul></li></ul></div></details></div><div class=post-content><h2 id=when-do-you-need-to-compile-cpython-yourself>When Do You Need to Compile CPython Yourself?<a hidden class=anchor aria-hidden=true href=#when-do-you-need-to-compile-cpython-yourself>#</a></h2><p>Most operating systems provide compiled CPython versions. Generally, installing through a package manager is sufficient. However, in some cases, you need to compile CPython yourself to meet specific requirements:</p><ul><li><p>The Python version provided by the OS is too old, and the Python official website or system package repositories do not provide pre-compiled new versions of Python.</p></li><li><p>Pre-compiled versions do not meet performance or extension requirements, for example, compiler optimizations are not enabled, or OpenSSL/SQLite versions do not meet requirements.</p></li><li><p>Participating in CPython development or trying out new features, such as Alpha/Beta/RC versions of Python.</p></li></ul><h2 id=precautions-when-compiling-cpython-on-older-linux-distributions>Precautions When Compiling CPython on Older Linux Distributions<a hidden class=anchor aria-hidden=true href=#precautions-when-compiling-cpython-on-older-linux-distributions>#</a></h2><h3 id=openssl>OpenSSL<a hidden class=anchor aria-hidden=true href=#openssl>#</a></h3><p>Because the OpenSSL version in the official CentOS 6 repository is too old and does not meet the requirements of Python 3.7 and later, running simple configure & make will result in an error. Solution:</p><p>Refer to <a href=https://benad.me/blog/2018/07/17/python-3.7-on-centos-6/>Python 3.7 on CentOS 6</a>, compile OpenSSL in advance, modify the <code>Modules/Setup</code> file when compiling CPython, and specify the environment variable <code>LDFLAGS="-Wl,-rpath=/usr/local/openssl11/lib"</code> and argument <code>-with-openssl=/usr/local/openssl11</code>.</p><h3 id=sqlite>SQLite<a hidden class=anchor aria-hidden=true href=#sqlite>#</a></h3><p>Software like Jupyter relies on SQLite. When compiling CPython, you should not only pay attention to the SQLite version but also enable <code>--enable-loadable-sqlite-extensions</code>. Refer to: <a href=https://stackoverflow.com/questions/57977481/how-to-use-enable-load-extension-from-sqlite3>How to use enable_load_extension from sqlite3?</a></p><h2 id=compilation-parameters-affecting-performance>Compilation Parameters Affecting Performance<a hidden class=anchor aria-hidden=true href=#compilation-parameters-affecting-performance>#</a></h2><h3 id=enable-optimizations>&ndash;enable-optimizations<a hidden class=anchor aria-hidden=true href=#enable-optimizations>#</a></h3><p>According to this StackOverflow question: <a href=https://stackoverflow.com/questions/41405728/what-does-enable-optimizations-do-while-compiling-python>what does &ndash;enable-optimizations do while compiling python?</a></p><p><code>enable-optimizations</code> enables <code>PGO</code> (Profile Guided Optimization) and <code>LTO</code> (Link Time Optimization) compiler optimizations. PGO performs two compilations. After the first compilation, it runs benchmark tests, and guides the second optimization compilation based on the tests.</p><p>The advantage is that it produces a more efficient CPython binary.</p><p>The disadvantage is that it firstly requires a certain compiler version (older GCC versions may error out during PGO compilation), and secondly, the compilation time increases significantly due to the benchmarks and the second compilation. Therefore, consider adding the <code>-j</code> parameter when running <code>make</code> to utilize multi-cores and reduce compilation time.</p><h4 id=-march>-march<a hidden class=anchor aria-hidden=true href=#-march>#</a></h4><p>Specifying the CPU architecture may also affect the performance of the compiled CPython. Extended reading: <a href=https://atleastfornow.net/posts/py3-enable-optimisations/>Compile-time Optimisations on Python 3</a></p><h3 id=-fno-semantic-interposition>-fno-semantic-interposition<a hidden class=anchor aria-hidden=true href=#-fno-semantic-interposition>#</a></h3><p>Refer to <a href=https://developers.redhat.com/blog/2020/06/25/red-hat-enterprise-linux-8-2-brings-faster-python-3-8-run-speeds/>Red Hat Enterprise Linux 8.2 brings faster Python 3.8 run speeds</a>.</p><p>Adding the <code>-fno-semantic-interposition</code> option during GCC compilation disables Semantic interposition on Red Hat / Fedora distributions, bringing up to a 30% performance improvement.</p><p>Of course, the above compilation parameters are related to specific distributions and compiler versions. You cannot simply assume they apply to all environments. The best way to evaluate performance is still to benchmark.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://zhoukuncheng.github.io/tags/python/>Python</a></li><li><a href=https://zhoukuncheng.github.io/tags/gcc/>GCC</a></li><li><a href=https://zhoukuncheng.github.io/tags/linux/>Linux</a></li></ul></footer><script src=https://giscus.app/client.js data-repo=zhoukuncheng/zhoukuncheng.github.io data-repo-id="MDEwOlJlcG9zaXRvcnkyODIxMTA1OTU=" data-category=General data-category-id=DIC_kwDOENCqg84Cexta data-mapping=og:title data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=purple_dark data-lang=en crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2025 <a href=https://zhoukuncheng.github.io/>zhoukuncheng's Personal Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script></body></html>